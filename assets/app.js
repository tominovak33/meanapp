angular.module("app",["ngRoute","ngAnimate"]),angular.module("app").controller("ApplicationCtrl",["$scope","$rootScope","UserSvc",function(t,e,o){t.baseUrl=location.host,window.localStorage.token&&o.getUser().then(function(e){t.$emit("userLoggedIn",e.data)}),t.$on("userLoggedIn",function(e,o){t.currentUser=o}),t.logout=function(){o.logout()}}]).filter("output_html",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]).filter("startFrom",function(){return function(t,e){return t?(e=+e,t.slice(e)):[]}}),angular.module("app").directive("staticInclude",["$http","$templateCache","$compile",function(t,e,o){return function(n,r,s){var a=s.staticInclude;t.get(a,{cache:e}).success(function(t){var e=r.html(t).contents();o(e)(n)})}}]),angular.module("app").controller("LoginCtrl",["$scope","UserSvc",function(t,e){t.login=function(o,n){e.login(o,n).then(function(e){t.$emit("userLoggedIn",e.data),window.location.href="#/"},function(e){t.loginValidation="Incorrect username & password combination"})},t.logout=function(){e.logout()}}]),angular.module("app").controller("PostsCtrl",["$scope","$http","PostsService","filterFilter","UserSvc","$timeout",function(t,e,o,n,r,s){t.baseUrl=location.host,t.bodyLengthLimit=250,t.postTagsArray=[],t.ckLoaded=!1,t.posts=[],t.addPost=function(){try{var e=CKEDITOR.instances.editor1.getData()}catch(n){console.error("CKEDITOR has not been loaded")}if(!e)var e=t.postContent;var r=t.urlDate(),s=t.slugify(t.postTitle),a=r+s;e&&o.send({body:e,title:t.postTitle,tags:t.postTagsArray,slug:a}).success(function(e){t.postBody=null,CKEDITOR.instances.editor1.setData(""),t.postTitle=null})},t.$on("$includeContentLoaded",function(){t.init_ckeditor()}),t.init_ckeditor=function(){t.ckLoaded=!0;try{{CKEDITOR.replace("editor1")}}catch(e){t.ckLoaded=!1,console.log("Error: "+e)}},t.$on("ws:new_post",function(e,o){o=o[0],t.$apply(function(){t.posts.unshift(o),t.paginate()})}),t.$on("$viewContentLoaded",function(){}),t.currentPage=1,t.postsPerPage=5,t.prevPage=function(){t.currentPage>1&&t.currentPage--},t.nextPage=function(){t.currentPage<t.posts.length/t.postsPerPage&&t.currentPage++},t.setPage=function(e){t.currentPage=e},t.range=function(t){return new Array(t)},t.$watch("search",function(e){t.filteredPosts=n(t.posts,e),t.paginate(t.filteredPosts.length)},!0),t.paginate=function(e){t.numberOfPages=Math.ceil(e>0?e/t.postsPerPage:t.posts.length/t.postsPerPage)},t.urlDate=function(t){if(void 0===t)var e=new Date;else var e=new Date(t);var o=e.getDate(),n=e.getMonth()+1,r=e.getFullYear();return String(r)+"/"+String(n)+"/"+String(o)+"/"},t.$watch("postTitle",function(e){e&&t.generateSlug(e)},!0),t.generateSlug=function(){t.slug=t.urlDate()+t.slugify(t.postTitle)},t.slugify=function(t){var e=t.toLowerCase();return e=e.replace(/\s+/g,"-"),e=e.replace(/\?/g,""),e=e.replace(/\&/g,""),e=e.replace(/\=/g,"")},t.addTag=function(e){t.postTagsArray.push(e),t.postTag=""},t.removeTag=function(e){t.postTagsArray.splice(e,1)},o.get().success(function(e){t.posts=e,t.paginate(t.posts.length)})}]),angular.module("app").service("PostsService",["$http",function(t){this.get=function(){return t.get("/api/posts")},this.send=function(e){return t.post("/api/posts",e)},this.removeItem=function(e){return t.post("/api/posts/removeItem",{params:{post_id:e.post_id}})},this.single_slug=function(e){return t.get("/api/posts",{params:{post_slug:e.slug}})},this.single_id=function(e){return t.get("/api/posts",{params:{post_id:e.id}})},this.user_posts=function(e){return t.get("/api/posts",{params:{_author:e._author}})},this.filtered_posts=function(e){return t.get("/api/posts",{params:e})}}]),angular.module("app").controller("ProfileCtrl",["$scope","$http","UserSvc","PostsService","$routeParams","$route","$location",function(t,e,o,n,r,s,a){t.editPermission=function(e){o.authorization().then(function(e){t=e})},t.baseUrl=location.host;var i=r.username;t["new"]={},o.profile(i).success(function(e){t.user_profile=e,n.user_posts({_author:t.user_profile._id}).success(function(e){t.user_posts=e,t.paginate(t.user_posts.length)})}),t.checkLogin=function(){window.localStorage.token&&o.getUser().then(function(e){t.currentUser=e.data,(t.user_profile._id==t.currentUser._id||t.editPermission(t.currentUser.permission_level))&&(t.canEdit=!0)})},t.currentUser=[],t.checkLogin(),t.$on("$viewContentLoaded",function(){}),t.user_posts=[],t.currentPage=1,t.postsPerPage=5,t.prevPage=function(){t.currentPage>1&&t.currentPage--},t.nextPage=function(){t.currentPage<t.user_posts.length/t.postsPerPage&&t.currentPage++},t.setPage=function(e){t.currentPage=e},t.range=function(t){return new Array(t)},t.paginate=function(e){t.numberOfPages=Math.ceil(e>0?e/t.postsPerPage:t.user_posts.length/t.postsPerPage)},t.range=function(t){return new Array(t)},o.authorization("10").then(function(t){console.log(t)}),t.saveProfile=function(){var e={_id:t.user_profile._id};for(var n in t["new"])t["new"].hasOwnProperty(n)&&""!=t["new"][n]&&(e[n]=t["new"][n]);o.profileUpdate(e).success(function(e){e.username!=t.user_profile.username?(t.returnMessage="Your username was changed so you must log in again",setTimeout(function(){window.location.href="/#/login"},1500)):t.returnMessage="Details updated successfully"})}}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc",function(t,e){t.register=function(o,n,r){return n!=r?void(t.validationMessage="Your passwords did not match."):void e.register(o,n)}}]),angular.module("app").config(["$routeProvider",function(t){t.when("/",{controller:"PostsCtrl",templateUrl:"post/allPosts.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"}).when("/post/:year/:month/:day/:slug",{controller:"SinglePostCtrl",templateUrl:"post/singlePost.html"}).when("/post/id/:id",{controller:"SinglePostCtrl",templateUrl:"singlePost.html"}).when("/post/new/",{controller:"PostsCtrl",templateUrl:"post/newPost.html"}).when("/user/:username",{controller:"ProfileCtrl",templateUrl:"post/userPosts.html"}).when("/tag/:tag",{controller:"TagCtrl",templateUrl:"post/tagPage.html"})}]),angular.module("app").controller("SinglePostCtrl",["$scope","$http","PostsService","$routeParams","$route","$location",function(t,e,o,n,r,s){t.singlePostView=!0,t.$on("$viewContentLoaded",function(){}),t.deleteItem=function(){o.removeItem({post_id:t.post._id}).success(function(t){console.log(t)})};var a=n.slug,i=n.id;if(a){var u="";u+=n.year+"/",u+=n.month+"/",u+=n.day+"/",u+=n.slug,o.single_slug({slug:u}).success(function(e){t.post=e[0],console.log(t.post)})}else i&&o.single_id({id:i}).success(function(e){t.post=e[0],console.log(t.post)})}]),angular.module("app").controller("TagCtrl",["$scope","$http","UserSvc","PostsService","$routeParams","$route","$location",function(t,e,o,n,r,s,a){t.baseUrl=location.host;var i=r.tag;t["new"]={},t.tagTitle=i,n.filtered_posts({tags:i}).success(function(e){t.posts=e})}]),angular.module("app").service("UserSvc",["$http",function(t){var e=this;e.getUser=function(){return t.defaults.headers.common["X-Auth"]=window.localStorage.token,t.get("/api/users").then(function(t){return t})},e.login=function(o,n){return t.post("/api/sessions",{username:o,password:n}).then(function(o){return window.localStorage.token=o.data,t.defaults.headers.common["X-Auth"]=o.data,e.getUser()})},e.register=function(o,n,r){return t.post("/api/users",{username:o,password:n}).then(function(t){return e.login(o,n).then(function(){window.location.href="/"})})},e.authorization=function(e){return t.defaults.headers.common["X-Auth"]=window.localStorage.token,t.get("/api/users/permissions").then(function(t){return console.log(t),t.data>e?!0:!1})},e.logout=function(){window.localStorage.removeItem("token"),window.location.href="/"},e.profile=function(e){return t.get("/api/users/profile",{params:{username:e}})},e.profileUpdate=function(e){return t.post("/api/users/profile",e)}}]),angular.module("app").run(["$rootScope","$timeout","$window",function(t,e,o){var n=10;!function r(){n+=n;var s="ws://"+o.location.host,a=new WebSocket(s);a.onopen=function(){},a.onclose=function(t){console.log("Websocket connection closed. Attempting to recconnect in "+n+" seconds"),e(r,1e3*n)},a.onmessage=function(e){var o=JSON.parse(e.data),n="ws:"+o.topic,r=o.data;t.$broadcast(n,r)}}()}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uQ3RybC5qcyIsImN1c3RvbURpcmVjdGl2ZXMuanMiLCJsb2dpbkNydGwuanMiLCJwb3N0c0N0cmwuanMiLCJwb3N0c1NlcnZpY2UuanMiLCJwcm9maWxlQ3RybC5qcyIsInJlZ2lzdHJhdGlvbkN0cmwuanMiLCJyb3V0ZXMuanMiLCJzaW5nbGVQb3N0c0N0cmwuanMiLCJ0YWdDdHJsLmpzIiwidXNlclNlcnZpY2UuanMiLCJ3ZWJzb2NrZXRzLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJHJvb3RTY29wZSIsIlVzZXJTdmMiLCJiYXNlVXJsIiwibG9jYXRpb24iLCJob3N0Iiwid2luZG93IiwibG9jYWxTdG9yYWdlIiwidG9rZW4iLCJnZXRVc2VyIiwidGhlbiIsInJlc3BvbnNlIiwiJGVtaXQiLCJkYXRhIiwiJG9uIiwiZXZlbnQiLCJ1c2VyIiwiY3VycmVudFVzZXIiLCJsb2dvdXQiLCJmaWx0ZXIiLCIkc2NlIiwidmFsIiwidHJ1c3RBc0h0bWwiLCJpbnB1dCIsInN0YXJ0Iiwic2xpY2UiLCJkaXJlY3RpdmUiLCIkaHR0cCIsIiR0ZW1wbGF0ZUNhY2hlIiwiJGNvbXBpbGUiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRycyIsInRlbXBsYXRlUGF0aCIsInN0YXRpY0luY2x1ZGUiLCJnZXQiLCJjYWNoZSIsInN1Y2Nlc3MiLCJjb250ZW50cyIsImh0bWwiLCJsb2dpbiIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJocmVmIiwiZXJyb3IiLCJsb2dpblZhbGlkYXRpb24iLCJQb3N0c1NlcnZpY2UiLCJmaWx0ZXJGaWx0ZXIiLCIkdGltZW91dCIsImJvZHlMZW5ndGhMaW1pdCIsInBvc3RUYWdzQXJyYXkiLCJja0xvYWRlZCIsInBvc3RzIiwiYWRkUG9zdCIsInBvc3RDb250ZW50IiwiQ0tFRElUT1IiLCJpbnN0YW5jZXMiLCJlZGl0b3IxIiwiZ2V0RGF0YSIsImVyciIsImNvbnNvbGUiLCJkYXRlX3NsdWciLCJ1cmxEYXRlIiwidGl0bGVfc2x1ZyIsInNsdWdpZnkiLCJwb3N0VGl0bGUiLCJzbHVnIiwic2VuZCIsImJvZHkiLCJ0aXRsZSIsInRhZ3MiLCJwb3N0IiwicG9zdEJvZHkiLCJzZXREYXRhIiwiaW5pdF9ja2VkaXRvciIsInJlcGxhY2UiLCJsb2ciLCJfIiwiJGFwcGx5IiwidW5zaGlmdCIsInBhZ2luYXRlIiwiY3VycmVudFBhZ2UiLCJwb3N0c1BlclBhZ2UiLCJwcmV2UGFnZSIsIm5leHRQYWdlIiwibGVuZ3RoIiwic2V0UGFnZSIsInBhZ2VfbnVtYmVyIiwicmFuZ2UiLCJuIiwiQXJyYXkiLCIkd2F0Y2giLCJ0ZXJtIiwiZmlsdGVyZWRQb3N0cyIsIm51bWJlcl9vZl9pdGVtcyIsIm51bWJlck9mUGFnZXMiLCJNYXRoIiwiY2VpbCIsInRpbWUiLCJ1bmRlZmluZWQiLCJkYXRlIiwiRGF0ZSIsImRheSIsImdldERhdGUiLCJtb250aCIsImdldE1vbnRoIiwieWVhciIsImdldEZ1bGxZZWFyIiwiU3RyaW5nIiwiZ2VuZXJhdGVTbHVnIiwic3RyaW5nIiwidG9Mb3dlckNhc2UiLCJhZGRUYWciLCJ0YWciLCJwdXNoIiwicG9zdFRhZyIsInJlbW92ZVRhZyIsInRhZ0luZGV4Iiwic3BsaWNlIiwic2VydmljZSIsInRoaXMiLCJyZW1vdmVJdGVtIiwicGFyYW1ldGVycyIsInBhcmFtcyIsInBvc3RfaWQiLCJzaW5nbGVfc2x1ZyIsInBvc3Rfc2x1ZyIsInNpbmdsZV9pZCIsImlkIiwidXNlcl9wb3N0cyIsIl9hdXRob3IiLCJmaWx0ZXJlZF9wb3N0cyIsInNlYXJjaFBhcmFtcyIsIiRyb3V0ZVBhcmFtcyIsIiRyb3V0ZSIsIiRsb2NhdGlvbiIsImVkaXRQZXJtaXNzaW9uIiwicGVybWlzc2lvbl9sZXZlbCIsImF1dGhvcml6YXRpb24iLCJwcm9maWxlIiwidXNlcl9wcm9maWxlIiwiX2lkIiwiY2hlY2tMb2dpbiIsImNhbkVkaXQiLCJzYXZlUHJvZmlsZSIsInByb2ZpbGVfZGV0YWlscyIsImtleSIsImhhc093blByb3BlcnR5IiwicHJvZmlsZVVwZGF0ZSIsInJldHVybk1lc3NhZ2UiLCJzZXRUaW1lb3V0IiwicmVnaXN0ZXIiLCJwYXNzd29yZF9jb25maXJtIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsInNpbmdsZVBvc3RWaWV3IiwiZGVsZXRlSXRlbSIsInBvc3RTbHVnIiwicG9zdElEIiwiZnVsbFBvc3RTbHVnIiwidGFnVGl0bGUiLCJ0YWdnZWRQb3N0cyIsInN2YyIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsInJ1biIsIiR3aW5kb3ciLCJyZWNvbm5lY3RfZGVsYXkiLCJjb25uZWN0IiwiY29ubmVjdGlvbiIsIldlYlNvY2tldCIsIm9ub3BlbiIsIm9uY2xvc2UiLCJlIiwib25tZXNzYWdlIiwibWVzc2FnZSIsIkpTT04iLCJwYXJzZSIsIm5hbWUiLCJ0b3BpYyIsIiRicm9hZGNhc3QiXSwibWFwcGluZ3MiOiJBQUNBQSxRQUFBQyxPQUFBLE9BQUEsVUFBQSxjQ0RBRCxRQUFBQyxPQUFBLE9BQ0FDLFdBQUEsbUJBQUEsU0FBQSxhQUFBLFVBQUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FNQUYsRUFBQUcsUUFBQUMsU0FBQUMsS0FHQUMsT0FBQUMsYUFBQUMsT0FDQU4sRUFBQU8sVUFDQUMsS0FBQSxTQUFBQyxHQUNBWCxFQUFBWSxNQUFBLGVBQUFELEVBQUFFLFFBSUFiLEVBQUFjLElBQUEsZUFBQSxTQUFBQyxFQUFBQyxHQUNBaEIsRUFBQWlCLFlBQUFELElBR0FoQixFQUFBa0IsT0FBQSxXQUNBaEIsRUFBQWdCLGFBSUFDLE9BQUEsZUFBQSxPQUFBLFNBQUFDLEdBQ0EsTUFBQSxVQUFBQyxHQUNBLE1BQUFELEdBQUFFLFlBQUFELE9BSUFGLE9BQUEsWUFBQSxXQUNBLE1BQUEsVUFBQUksRUFBQUMsR0FDQSxNQUFBRCxJQUNBQyxHQUFBQSxFQUNBRCxFQUFBRSxN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QXVMLFdBQUFGLEVBQUF6SyIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL1RoaXMgZmlsZSBtdXN0IGJlIHRoZSBmaXJzdCBpbiB0aGUgbGlzdCB0byBiZSBjb25jYXRlbmF0ZWRcbmFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ25nUm91dGUnLCAnbmdBbmltYXRlJ10pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5jb250cm9sbGVyKCdBcHBsaWNhdGlvbkN0cmwnICwgW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIlVzZXJTdmNcIiwgZnVuY3Rpb24gKCRzY29wZSwgJHJvb3RTY29wZSwgVXNlclN2Yykge1xuXHRcdC8qXG5cdFx0SWYgd2UgaGF2ZSBhIHN0b3JlZCB0b2tlbiwgZ2V0IHRoZSB1c2VyIGluZm9ybWF0aW9uIGZyb20gaXRcblx0XHRhbmQgZW1pdCB0aGUgdXNlciBsb2dnZWRpbiBtZXNzYWdlcyBpbiBvcmRlciB0byBhbGxvdyB0aGUgVUkgdG8gXG5cdFx0aW5kaWNhdGUgdG8gdGhlIHVzZXIgdGhhdCB0aGV5IHdlcmUgbG9nZ2VkIGluXG5cdFx0Ki9cblx0XHQkc2NvcGUuYmFzZVVybCA9IGxvY2F0aW9uLmhvc3Q7XG5cblx0XHRcblx0XHRpZiAod2luZG93LmxvY2FsU3RvcmFnZS50b2tlbikge1xuXHRcdFx0VXNlclN2Yy5nZXRVc2VyKClcblx0XHRcdFx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKXtcblx0XHRcdFx0XHQkc2NvcGUuJGVtaXQoJ3VzZXJMb2dnZWRJbicsIHJlc3BvbnNlLmRhdGEpO1xuXHRcdFx0XHR9KVxuXHRcdH1cblxuXHRcdCRzY29wZS4kb24oJ3VzZXJMb2dnZWRJbicsIGZ1bmN0aW9uKGV2ZW50LCB1c2VyKSB7XG5cdFx0XHQkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuXHRcdH0pXG5cblx0XHQkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0VXNlclN2Yy5sb2dvdXQoKTtcblx0XHR9XG5cdH1dKVxuXG5cdC5maWx0ZXIoJ291dHB1dF9odG1sJywgW1wiJHNjZVwiLCBmdW5jdGlvbiAoJHNjZSkge1xuXHRcdHJldHVybiBmdW5jdGlvbih2YWwpIHtcblx0ICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbCh2YWwpO1xuXHQgICAgfTtcblx0fV0pXG5cblx0LmZpbHRlcignc3RhcnRGcm9tJywgZnVuY3Rpb24oKSB7XG5cdCAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQsIHN0YXJ0KSB7XG5cdCAgICAgICAgaWYoaW5wdXQpIHtcblx0ICAgICAgICAgICAgc3RhcnQgPSArc3RhcnQ7IC8vcGFyc2UgdG8gaW50XG5cdCAgICAgICAgICAgIHJldHVybiBpbnB1dC5zbGljZShzdGFydCk7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIHJldHVybiBbXTtcblx0ICAgIH1cblx0fSk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHRvbWkgb24gMTkvMDEvMTYuXG4gKi9cbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAgIC5kaXJlY3RpdmUoJ3N0YXRpY0luY2x1ZGUnLCBbJyRodHRwJywgJyR0ZW1wbGF0ZUNhY2hlJywgJyRjb21waWxlJywgZnVuY3Rpb24gKCRodHRwLCAkdGVtcGxhdGVDYWNoZSwgJGNvbXBpbGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGVtcGxhdGVQYXRoID0gYXR0cnMuc3RhdGljSW5jbHVkZTtcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQodGVtcGxhdGVQYXRoLCB7IGNhY2hlOiAkdGVtcGxhdGVDYWNoZSB9KS5zdWNjZXNzKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50cyA9IGVsZW1lbnQuaHRtbChyZXNwb25zZSkuY29udGVudHMoKTtcbiAgICAgICAgICAgICAgICAgICAgJGNvbXBpbGUoY29udGVudHMpKHNjb3BlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgfV0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5jb250cm9sbGVyKCdMb2dpbkN0cmwnICwgW1wiJHNjb3BlXCIgLCBcIlVzZXJTdmNcIiAsIGZ1bmN0aW9uICgkc2NvcGUsIFVzZXJTdmMpIHtcblx0XHQkc2NvcGUubG9naW4gPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkKSB7XG5cdFx0XHRVc2VyU3ZjLmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZClcblx0XHRcdFx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKXtcblx0XHRcdFx0XHQkc2NvcGUuJGVtaXQoJ3VzZXJMb2dnZWRJbicsIHJlc3BvbnNlLmRhdGEpO1xuXHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJyMvJ1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRmdW5jdGlvbihlcnJvcil7XG5cdFx0XHRcdCAgJHNjb3BlLmxvZ2luVmFsaWRhdGlvbiA9ICdJbmNvcnJlY3QgdXNlcm5hbWUgJiBwYXNzd29yZCBjb21iaW5hdGlvbic7XG5cdFx0XHRcdH0pXG5cblx0XHR9XG5cblx0XHQkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0VXNlclN2Yy5sb2dvdXQoKVxuXHRcdH1cblx0fV0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5jb250cm9sbGVyKCdQb3N0c0N0cmwnLCBbXCIkc2NvcGVcIiAsIFwiJGh0dHBcIiwgXCJQb3N0c1NlcnZpY2VcIiwgXCJmaWx0ZXJGaWx0ZXJcIiwgXCJVc2VyU3ZjXCIsIFwiJHRpbWVvdXRcIiwgZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsIFBvc3RzU2VydmljZSwgZmlsdGVyRmlsdGVyLCBVc2VyU3ZjLCAkdGltZW91dCkge1xuXHRcdCRzY29wZS5iYXNlVXJsID0gbG9jYXRpb24uaG9zdDtcblx0XHQkc2NvcGUuYm9keUxlbmd0aExpbWl0ID0gMjUwO1xuXHRcdCRzY29wZS5wb3N0VGFnc0FycmF5ID0gW107XG5cdFx0JHNjb3BlLmNrTG9hZGVkID0gZmFsc2U7XG5cblx0XHQkc2NvcGUucG9zdHMgPSBbXTtcblx0XHQkc2NvcGUuYWRkUG9zdCA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHZhciBwb3N0Q29udGVudCA9IENLRURJVE9SLmluc3RhbmNlcy5lZGl0b3IxLmdldERhdGEoKTtcblx0XHRcdH1cblx0XHRcdGNhdGNoKGVycikge1xuXHRcdFx0XHQvLyBja2VkaXRvciBpcyBub3QgbG9hZGVkXG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJDS0VESVRPUiBoYXMgbm90IGJlZW4gbG9hZGVkXCIpO1xuXHRcdFx0fVxuXHRcdFx0aWYgKCFwb3N0Q29udGVudCkge1xuXHRcdFx0XHR2YXIgcG9zdENvbnRlbnQgPSAkc2NvcGUucG9zdENvbnRlbnQ7XG5cdFx0XHR9XG5cblx0XHRcdHZhciBkYXRlX3NsdWcgPSAkc2NvcGUudXJsRGF0ZSgpO1xuXHRcdFx0dmFyIHRpdGxlX3NsdWcgPSAkc2NvcGUuc2x1Z2lmeSgkc2NvcGUucG9zdFRpdGxlKTtcblxuXHRcdFx0dmFyIHNsdWcgPSBkYXRlX3NsdWcgKyB0aXRsZV9zbHVnO1xuXG5cdFx0XHRpZiAocG9zdENvbnRlbnQpIHtcblx0XHRcdFx0UG9zdHNTZXJ2aWNlLnNlbmQoe1xuXHRcdFx0XHRcdGJvZHk6IHBvc3RDb250ZW50LFxuXHRcdFx0XHRcdHRpdGxlOiAkc2NvcGUucG9zdFRpdGxlLFxuXHRcdFx0XHRcdHRhZ3M6ICRzY29wZS5wb3N0VGFnc0FycmF5LFxuXHRcdFx0XHRcdHNsdWc6IHNsdWdcblx0XHRcdFx0fSlcblx0XHRcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24gKHBvc3QpIHtcblx0XHRcdFx0XHQvKlxuXHRcdFx0XHRcdC8vUmVtb3ZlZCBhcyB3ZWJzb2NrZXQgYnJvYWRjYXN0IHdvdWxkIGNhdXNlIHRoZSBwb3N0IHRvIGFwcGVhciBkdXBsaWNhdGVkIG9uIHRoZSBicm93c2VyIHRoYXQgaXQgd2FzIHBvc3RlZCBmcm9tIFxuXHRcdFx0XHRcdC8vYXMgYm90aCBvZiB0aGUgZnVuY3Rpb25zIHdvdWxkIGdldCBleGVjdXRlZCBiZWNhdXNlIHRoZSBjbGllbnQgd2hvIHNlbmRzIHRoZSBwb3N0IHdvdWxkIHN0aWxsIHJlY2lldmUgdGhlIHdlYnNvY2tldHMgYnJvYWRjYXN0IGJhY2sgZnJvbSB0aGUgc2VydmVyICBcblx0XHRcdFx0XHQqL1xuXHRcdFx0XHRcdCRzY29wZS5wb3N0Qm9keSA9IG51bGw7XG5cdFx0XHRcdFx0Q0tFRElUT1IuaW5zdGFuY2VzLmVkaXRvcjEuc2V0RGF0YSgnJyk7XG5cdFx0XHRcdFx0JHNjb3BlLnBvc3RUaXRsZSA9IG51bGw7XG5cdFx0XHRcdH0pXG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdCRzY29wZS4kb24oJyRpbmNsdWRlQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uICgpIHtcblx0XHRcdCRzY29wZS5pbml0X2NrZWRpdG9yKCk7XG5cdFx0fSk7XG5cblx0XHQkc2NvcGUuaW5pdF9ja2VkaXRvciA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdCRzY29wZS5ja0xvYWRlZCA9IHRydWU7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHR2YXIgZWRpdG9yID0gQ0tFRElUT1IucmVwbGFjZSgnZWRpdG9yMScpO1xuXHRcdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRcdCRzY29wZS5ja0xvYWRlZCA9IGZhbHNlO1xuXHRcdFx0XHRjb25zb2xlLmxvZyhcIkVycm9yOiBcIiArIGVycik7XG5cdFx0XHR9XG5cdFx0XHQvL2lmICh0eXBlb2YgZWRpdG9yID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0Ly9cdCR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0Ly9cdFx0JHNjb3BlLmluaXRfY2tlZGl0b3IoKTtcblx0XHRcdC8vXHR9LCAxMDAwKVxuXHRcdFx0Ly99XG5cdFx0fTtcblxuXHRcdCRzY29wZS4kb24oJ3dzOm5ld19wb3N0JywgZnVuY3Rpb24oXywgcG9zdCkge1xuXHRcdFx0cG9zdCA9IHBvc3RbMF07XG5cdFx0XHQkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0JHNjb3BlLnBvc3RzLnVuc2hpZnQocG9zdCk7XG5cdFx0XHRcdCRzY29wZS5wYWdpbmF0ZSgpO1xuXHRcdFx0fSlcblx0XHR9KTtcblxuXHRcdCRzY29wZS4kb24oJyR2aWV3Q29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCl7XG5cdFx0XHQvL3RoZSBwYWdlIGlzIHJlYWR5XG5cdFx0fSk7XG5cblx0XHQkc2NvcGUuY3VycmVudFBhZ2UgPSAxO1xuXHRcdCRzY29wZS5wb3N0c1BlclBhZ2UgPSA1O1xuXG5cdFx0JHNjb3BlLnByZXZQYWdlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIGlmICgkc2NvcGUuY3VycmVudFBhZ2UgPiAxKSB7XG5cdCAgICAgICAgICAgICRzY29wZS5jdXJyZW50UGFnZS0tO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG4gICAgXG5cdCAgICAkc2NvcGUubmV4dFBhZ2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgaWYgKCRzY29wZS5jdXJyZW50UGFnZSA8ICRzY29wZS5wb3N0cy5sZW5ndGgvJHNjb3BlLnBvc3RzUGVyUGFnZSkge1xuXHQgICAgICAgICAgICAkc2NvcGUuY3VycmVudFBhZ2UrKztcblx0ICAgICAgICB9XG5cdCAgICB9O1xuXHQgICAgXG5cdCAgICAkc2NvcGUuc2V0UGFnZSA9IGZ1bmN0aW9uIChwYWdlX251bWJlcikge1xuXHQgICAgICAgICRzY29wZS5jdXJyZW50UGFnZSA9IHBhZ2VfbnVtYmVyO1xuXHQgICAgfTtcblxuXHQgICAgLy9UaGlzIHdheSBJIGNhbiBkbzogIFwiPGxpIG5nLXJlcGVhdD1cIm4gaW4gcmFuZ2UocGFnZXMpIHRyYWNrIGJ5ICRpbmRleFwiPlwiIGFuZCBzbyBJIGNhbiBkaXNwbGF5IGFzIG1hbnkgaXRlbXMgYXMgdGhlIHZhbHVlIG9mIGEgbnVtYmVyIGFzIHRoaXMgcmV0dXJucyBhbiBhcnJheSBvZiB0aGF0IGxlbmdodFxuXHQgICAgJHNjb3BlLnJhbmdlID0gZnVuY3Rpb24obikge1xuICAgICAgICBcdHJldHVybiBuZXcgQXJyYXkobik7XG4gICAgXHR9O1xuXHQgICAgXG5cdCAgICAvL3dhdGNoIHRvIHNlZSBpZiBzZWFyY2hpbmcgYW5kIHJlcGFnaW5hdGUgaWYgd2UgYXJlXG5cdCAgICAvL3RydWUgYXQgdGhlIGVuZCAgbWFnaWNhbGx5IG1ha2VzIGl0IHNvIHRoYXQgYXMgZWFjaCBleHRyYSBsZXR0ZXIgaXMgYWRkZWQgdG8gdGhlIHNlYXJjaCB3ZSBjYW4gcmVwYWdpbmF0ZVxuXHQgICAgLy93aXRob3V0IHRoZSAndHJ1ZScgaXQgb25seSBkaWQgIHRoYXRcblx0ICAgICRzY29wZS4kd2F0Y2goJ3NlYXJjaCcsIGZ1bmN0aW9uKHRlcm0pIHtcblx0ICAgICAgICAkc2NvcGUuZmlsdGVyZWRQb3N0cyA9IGZpbHRlckZpbHRlcigkc2NvcGUucG9zdHMsIHRlcm0pO1xuXHQgICAgICAgICRzY29wZS5wYWdpbmF0ZSgkc2NvcGUuZmlsdGVyZWRQb3N0cy5sZW5ndGgpO1xuXHQgICAgfSwgdHJ1ZSk7XG5cblxuXHQgICAgJHNjb3BlLnBhZ2luYXRlID0gZnVuY3Rpb24obnVtYmVyX29mX2l0ZW1zKXtcblx0ICAgIFx0aWYgKG51bWJlcl9vZl9pdGVtcyA+IDApIHtcblx0ICAgICAgICBcdCRzY29wZS5udW1iZXJPZlBhZ2VzID0gTWF0aC5jZWlsKG51bWJlcl9vZl9pdGVtcy8kc2NvcGUucG9zdHNQZXJQYWdlKTtcblx0ICAgICAgICB9XG5cdCAgICAgICAgZWxzZSB7XG5cdCAgICAgICAgXHQkc2NvcGUubnVtYmVyT2ZQYWdlcyA9IE1hdGguY2VpbCgkc2NvcGUucG9zdHMubGVuZ3RoLyRzY29wZS5wb3N0c1BlclBhZ2UpO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG5cblx0ICAgICRzY29wZS51cmxEYXRlID0gZnVuY3Rpb24odGltZSkge1xuXHRcdFx0aWYgKHRpbWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHR2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0dmFyIGRhdGUgPSBuZXcgRGF0ZSh0aW1lKTtcblx0XHRcdH1cblx0XHQgICAgdmFyIGRheSA9IGRhdGUuZ2V0RGF0ZSgpO1xuXHRcdCAgICB2YXIgbW9udGggPSBkYXRlLmdldE1vbnRoKCkrMTsgLy8rMSBiZWNhdXNlIG1vbnRocyBhcmUgMCBpbmRleGVkXG5cdFx0ICAgIHZhciB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xuXG4gICAgICAgICAgICByZXR1cm4gU3RyaW5nKHllYXIpICsgJy8nICsgU3RyaW5nKG1vbnRoKSArICcvJyArIFN0cmluZyhkYXkpICsgJy8nIDtcbiAgICAgICAgfTtcblxuXHRcdCRzY29wZS4kd2F0Y2goJ3Bvc3RUaXRsZScsIGZ1bmN0aW9uKHRpdGxlKSB7XG5cdFx0XHRpZiAodGl0bGUpIHtcblx0XHRcdFx0JHNjb3BlLmdlbmVyYXRlU2x1Zyh0aXRsZSk7XG5cdFx0XHR9XG5cdFx0fSwgdHJ1ZSk7XG5cblx0XHQkc2NvcGUuZ2VuZXJhdGVTbHVnID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0JHNjb3BlLnNsdWcgPSAkc2NvcGUudXJsRGF0ZSgpICsgJHNjb3BlLnNsdWdpZnkoJHNjb3BlLnBvc3RUaXRsZSk7XG5cdFx0fTtcblxuXHQgICAgJHNjb3BlLnNsdWdpZnkgPSBmdW5jdGlvbihzdHJpbmcpIHtcblx0ICAgIFx0dmFyIHNsdWcgPSAgc3RyaW5nLnRvTG93ZXJDYXNlKCk7XG5cdCAgICBcdHNsdWcgPSBzbHVnLnJlcGxhY2UoL1xccysvZyxcIi1cIik7XG5cdCAgICBcdHNsdWcgPSBzbHVnLnJlcGxhY2UoL1xcPy9nLCBcIlwiKTtcblx0ICAgIFx0c2x1ZyA9IHNsdWcucmVwbGFjZSgvXFwmL2csIFwiXCIpO1xuXHQgICAgXHRzbHVnID0gc2x1Zy5yZXBsYWNlKC9cXD0vZywgXCJcIik7XG5cdCAgICBcdHJldHVybiBzbHVnO1xuXHQgICAgfTtcblxuXHRcdCRzY29wZS5hZGRUYWcgPSBmdW5jdGlvbih0YWcpIHtcblx0XHRcdC8vY29uc29sZS5sb2codGFnKTtcblx0XHRcdCRzY29wZS5wb3N0VGFnc0FycmF5LnB1c2godGFnKTtcblx0XHRcdCRzY29wZS5wb3N0VGFnID0gJyc7XG5cdFx0fTtcblxuXHRcdCRzY29wZS5yZW1vdmVUYWcgPSBmdW5jdGlvbih0YWdJbmRleCkge1xuXHRcdFx0JHNjb3BlLnBvc3RUYWdzQXJyYXkuc3BsaWNlKHRhZ0luZGV4LCAxKTtcblx0XHR9O1xuXG5cdFBvc3RzU2VydmljZS5nZXQoKVxuXHRcdC5zdWNjZXNzKGZ1bmN0aW9uIChwb3N0cykge1xuXHRcdFx0JHNjb3BlLnBvc3RzID0gcG9zdHM7XG5cdFx0XHQvL2NvbnNvbGUubG9nKHBvc3RzKTsgLy9Mb2cgYWxsIHRoZSBwb3N0cyByZWNpZXZlZCBmcm9tIHRoZSBzZXJ2ZXJcblx0XHRcdCRzY29wZS5wYWdpbmF0ZSgkc2NvcGUucG9zdHMubGVuZ3RoKTtcblx0XHR9KVxuXG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuc2VydmljZSgnUG9zdHNTZXJ2aWNlJywgW1wiJGh0dHBcIiAsIGZ1bmN0aW9uICgkaHR0cCkge1xuXHRcdHRoaXMuZ2V0ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9wb3N0cycpO1xuXHRcdH1cblx0XHR0aGlzLnNlbmQgPSBmdW5jdGlvbiAocG9zdCkge1xuXHRcdFx0cmV0dXJuICRodHRwLnBvc3QoJy9hcGkvcG9zdHMnLCBwb3N0KTtcblx0XHR9XG5cdFx0dGhpcy5yZW1vdmVJdGVtID0gZnVuY3Rpb24gKHBhcmFtZXRlcnMpIHtcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Bvc3RzL3JlbW92ZUl0ZW0nLCB7IHBhcmFtczoge3Bvc3RfaWQ6IHBhcmFtZXRlcnMucG9zdF9pZH0gfSk7XG5cdFx0fVxuXHRcdHRoaXMuc2luZ2xlX3NsdWcgPSBmdW5jdGlvbiAocGFyYW1ldGVycykge1xuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9wb3N0cycsIHsgcGFyYW1zOiB7cG9zdF9zbHVnOiBwYXJhbWV0ZXJzLnNsdWd9IH0gKTtcblx0XHR9XG5cdFx0dGhpcy5zaW5nbGVfaWQgPSBmdW5jdGlvbiAocGFyYW1ldGVycykge1xuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9wb3N0cycsIHsgcGFyYW1zOiB7cG9zdF9pZDogcGFyYW1ldGVycy5pZH0gfSApO1xuXHRcdH1cblx0XHR0aGlzLnVzZXJfcG9zdHMgPSBmdW5jdGlvbiAocGFyYW1ldGVycykge1xuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9wb3N0cycsIHsgcGFyYW1zOiB7X2F1dGhvcjogcGFyYW1ldGVycy5fYXV0aG9yfSB9ICk7XG5cdFx0fVxuXHRcdHRoaXMuZmlsdGVyZWRfcG9zdHMgPSBmdW5jdGlvbiAoc2VhcmNoUGFyYW1zKSB7XG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3Bvc3RzJywgeyBwYXJhbXM6IHNlYXJjaFBhcmFtcyB9ICk7XG5cdFx0fVxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcblx0LmNvbnRyb2xsZXIoJ1Byb2ZpbGVDdHJsJywgW1wiJHNjb3BlXCIgLCBcIiRodHRwXCIsIFwiVXNlclN2Y1wiLCBcIlBvc3RzU2VydmljZVwiICwgXCIkcm91dGVQYXJhbXNcIiwgXCIkcm91dGVcIiwgXCIkbG9jYXRpb25cIiAsIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCBVc2VyU3ZjLCBQb3N0c1NlcnZpY2UsICRyb3V0ZVBhcmFtcywgJHJvdXRlLCAkbG9jYXRpb24pIHtcblxuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0LyBHZXQgdXNlciBwZXJtaXNzaW9uc1xuXHRcdC8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblx0XHQkc2NvcGUuZWRpdFBlcm1pc3Npb24gPSBmdW5jdGlvbihwZXJtaXNzaW9uX2xldmVsKSB7XG5cdFx0ICBcdFVzZXJTdmMuYXV0aG9yaXphdGlvbigpXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSl7XG5cdFx0XHRcdFx0JHNjb3BlPShyZXNwb25zZSk7XG5cdFx0XHRcdH0pXG5cdFx0fVxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8gRW5kIHVzZXIgcGVybWlzc2lvbnNcblx0XHQvLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblxuXHRcdCRzY29wZS5iYXNlVXJsID0gbG9jYXRpb24uaG9zdDtcblx0XHR2YXIgdXNlcm5hbWUgPSAkcm91dGVQYXJhbXMudXNlcm5hbWU7XG5cdFx0JHNjb3BlLm5ldyAgPSB7fTtcblxuXHRcdFVzZXJTdmMucHJvZmlsZSh1c2VybmFtZSlcblx0XHRcdC5zdWNjZXNzKGZ1bmN0aW9uICh1c2VyX3Byb2ZpbGUpIHtcblx0XHRcdFx0JHNjb3BlLnVzZXJfcHJvZmlsZSA9IHVzZXJfcHJvZmlsZTtcblx0XHRcdFx0UG9zdHNTZXJ2aWNlLnVzZXJfcG9zdHMgKHtcblx0XHRcdFx0XHRfYXV0aG9yOiAkc2NvcGUudXNlcl9wcm9maWxlLl9pZFxuXHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5zdWNjZXNzKGZ1bmN0aW9uICh1c2VyX3Bvc3RzKSB7XG5cdFx0XHRcdFx0XHQkc2NvcGUudXNlcl9wb3N0cyA9IHVzZXJfcG9zdHM7XG5cdFx0XHRcdFx0XHQkc2NvcGUucGFnaW5hdGUoJHNjb3BlLnVzZXJfcG9zdHMubGVuZ3RoKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0fSlcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8gQ2hlY2sgY3VycmVudGx5IGxvZ2dlZCBpbiB1c2VyIFxuXHRcdC8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0JHNjb3BlLmNoZWNrTG9naW4gPSBmdW5jdGlvbigpIHtcblx0XHRcdC8vaXMgYW55b25lIGxvZ2dlZCBpblxuXHRcdCAgXHRpZiAod2luZG93LmxvY2FsU3RvcmFnZS50b2tlbikge1xuXHRcdFx0ICBcdC8vZ2V0IGN1cnJlbnQgdXNlclxuXHRcdFx0ICBcdFVzZXJTdmMuZ2V0VXNlcigpXG5cdFx0XHRcdFx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKXtcblx0XHRcdFx0XHRcdCRzY29wZS5jdXJyZW50VXNlciA9IHJlc3BvbnNlLmRhdGE7XG5cdFx0XHRcdFx0XHRcdC8vaXMgdGhlIHVzZXIgdGhlIHNhbWUgYXMgdGhlIHVzZXIgd2hvJ3MgcGFnZSB0aGlzIGlzIG9yIHRoZXkgaGF2ZSBhIGhpZ2hlciBwZXJtaXNzaW9uIGxldmVsIHRoZW4gbGV0IHRoZW0gZWRpdCB0aGUgcGFnZVxuXHRcdFx0XHRcdFx0XHRpZiAoJHNjb3BlLnVzZXJfcHJvZmlsZS5faWQgPT0gJHNjb3BlLmN1cnJlbnRVc2VyLl9pZCB8fCAkc2NvcGUuZWRpdFBlcm1pc3Npb24oJHNjb3BlLmN1cnJlbnRVc2VyLnBlcm1pc3Npb25fbGV2ZWwpICkge1xuXHRcdFx0XHRcdFx0XHRcdCRzY29wZS5jYW5FZGl0ID0gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pXG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8gRW5kIHVzZXIgY2hlY2sgXG5cdFx0Ly0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHQkc2NvcGUuY3VycmVudFVzZXIgPSBbXTtcblxuXHRcdCRzY29wZS5jaGVja0xvZ2luKCk7XG5cblx0XHQkc2NvcGUuJG9uKCckdmlld0NvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpe1xuXHRcdFx0Ly90aGUgcGFnZSBpcyByZWFkeVxuXHRcdH0pO1xuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0LyBQYWdpbmF0aW9uIFxuXHRcdC8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0JHNjb3BlLnVzZXJfcG9zdHMgPSBbXTtcblxuXHRcdCRzY29wZS5jdXJyZW50UGFnZSA9IDE7XG5cdFx0JHNjb3BlLnBvc3RzUGVyUGFnZSA9IDU7XG5cblx0XHQkc2NvcGUucHJldlBhZ2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgaWYgKCRzY29wZS5jdXJyZW50UGFnZSA+IDEpIHtcblx0ICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRQYWdlLS07XG5cdCAgICAgICAgfVxuXHQgICAgfTtcbiAgICBcblx0ICAgICRzY29wZS5uZXh0UGFnZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBpZiAoJHNjb3BlLmN1cnJlbnRQYWdlIDwgJHNjb3BlLnVzZXJfcG9zdHMubGVuZ3RoLyRzY29wZS5wb3N0c1BlclBhZ2UpIHtcblx0ICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRQYWdlKys7XG5cdCAgICAgICAgfVxuXHQgICAgfTtcblx0ICAgIFxuXHQgICAgJHNjb3BlLnNldFBhZ2UgPSBmdW5jdGlvbiAocGFnZV9udW1iZXIpIHtcblx0ICAgICAgICAkc2NvcGUuY3VycmVudFBhZ2UgPSBwYWdlX251bWJlcjtcblx0ICAgIH07XG5cblx0ICAgIC8vVGhpcyB3YXkgSSBjYW4gZG86ICBcIjxsaSBuZy1yZXBlYXQ9XCJuIGluIHJhbmdlKHBhZ2VzKSB0cmFjayBieSAkaW5kZXhcIj5cIiBhbmQgc28gSSBjYW4gZGlzcGxheSBhcyBtYW55IGl0ZW1zIGFzIHRoZSB2YWx1ZSBvZiBhIG51bWJlciBhcyB0aGlzIHJldHVybnMgYW4gYXJyYXkgb2YgdGhhdCBsZW5naHRcblx0ICAgICRzY29wZS5yYW5nZSA9IGZ1bmN0aW9uKG4pIHtcbiAgICAgICAgXHRyZXR1cm4gbmV3IEFycmF5KG4pO1xuICAgIFx0fTtcblx0ICAgIFxuXG5cdFx0JHNjb3BlLnBhZ2luYXRlID0gZnVuY3Rpb24obnVtYmVyX29mX2l0ZW1zKXtcblx0ICAgIFx0aWYgKG51bWJlcl9vZl9pdGVtcyA+IDApIHtcblx0ICAgICAgICBcdCRzY29wZS5udW1iZXJPZlBhZ2VzID0gTWF0aC5jZWlsKG51bWJlcl9vZl9pdGVtcy8kc2NvcGUucG9zdHNQZXJQYWdlKTtcblx0ICAgICAgICB9XG5cdCAgICAgICAgZWxzZSB7XG5cdCAgICAgICAgXHQkc2NvcGUubnVtYmVyT2ZQYWdlcyA9IE1hdGguY2VpbCgkc2NvcGUudXNlcl9wb3N0cy5sZW5ndGgvJHNjb3BlLnBvc3RzUGVyUGFnZSk7XG5cdCAgICAgICAgfVxuXHQgICAgfTtcblxuXG5cblx0ICAgIC8vVGhpcyB3YXkgSSBjYW4gZG86ICBcIjxsaSBuZy1yZXBlYXQ9XCJuIGluIHJhbmdlKHBhZ2VzKSB0cmFjayBieSAkaW5kZXhcIj5cIiBhbmQgc28gSSBjYW4gZGlzcGxheSBhcyBtYW55IGl0ZW1zIGFzIHRoZSB2YWx1ZSBvZiBhIG51bWJlciBhcyB0aGlzIHJldHVybnMgYW4gYXJyYXkgb2YgdGhhdCBsZW5naHRcblx0ICAgICRzY29wZS5yYW5nZSA9IGZ1bmN0aW9uKG4pIHtcbiAgICAgICAgXHRyZXR1cm4gbmV3IEFycmF5KG4pO1xuICAgIFx0fTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8gRW5kIFBhZ2luYXRpb24gXG5cdFx0Ly0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdCAgXHRVc2VyU3ZjLmF1dGhvcml6YXRpb24oJzEwJylcblx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSl7XG5cdFx0XHRcdGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcblx0XHRcdH0pXG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvIFByb2ZpbGUgZWRpdCBvcHRpb25zIFxuXHRcdC8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdCRzY29wZS5zYXZlUHJvZmlsZSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0Ly9nZXQgdGhlIGlkIG9mIHRoZSBjdXJyZW50bHkgbG9nZ2VkIGluIHVzZXIncyBJRC4gU28gd2UgY2FuIHVzZSB0aGlzIHRvIGVkaXQgdGhlIHVzZXIuIHRvZG86IGNoYW5nZSB0aGlzIHNvIHRoZSBzdXBlcnVzZXJzIGNhbiBjaG9vc2Ugd2hvIGlzIGVkaXRlZCB3aGVuIHRoZXkgdmlzaXQgdGhlIHBhZ2Vcblx0XHRcdHZhciBwcm9maWxlX2RldGFpbHMgPSB7XG5cdFx0XHRcdF9pZCA6ICRzY29wZS51c2VyX3Byb2ZpbGUuX2lkXG5cdFx0XHR9O1xuXG5cdFx0XHQvL2l0ZXJhdGUgdGhyb3VnaCB0aGUgbmV3IGRldGFpbHMsIGlmIHRoZXkgYXJlIG5vdCBlbXB0eSB0aGVuIGFkZCB0aGVtIHRvIHRoZSBwcm9maWxlIGRldGFpbHMgb2JqZWN0XG5cdFx0XHRmb3IgKHZhciBrZXkgaW4gJHNjb3BlLm5ldykge1xuXHRcdFx0ICBpZiAoJHNjb3BlLm5ldy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG5cdFx0XHQgICAgLy9hbGVydChrZXkgKyBcIiAtPiBcIiArICRzY29wZS5uZXdba2V5XSk7XG5cdFx0XHQgICAgaWYgKCRzY29wZS5uZXdba2V5XSAhPSAnJykge1xuXHRcdFx0ICAgIFx0cHJvZmlsZV9kZXRhaWxzW2tleV0gPSAkc2NvcGUubmV3W2tleV07XG5cdFx0XHQgICAgfVxuXHRcdFx0ICB9XG5cdFx0XHR9XG5cblx0XHRcdC8vc2VuZCB0aGlzIHByb2ZpbGUgZGV0YWlscyBvYmVqZWN0IHRvIHRoZSB1c2VyIHNlcnZpY2UuIFRoaXMgdGhlbiB1cGRhdGVkIG9yIGFkZHMgYWxsIGRldGFpbCBpbiB0aGlzIHRvIHRoZSB1c2VyIHdobydzIElEIHdhcyBzZWxlY3RlZCBlYXJsaWVyXG5cdFx0XHRVc2VyU3ZjLnByb2ZpbGVVcGRhdGUocHJvZmlsZV9kZXRhaWxzKVxuXHRcdFx0XHQuc3VjY2VzcyhmdW5jdGlvbiAodXNlcikge1xuXHRcdFx0XHRcdC8vY29uc29sZS5sb2codXNlcik7XG5cdFx0XHRcdFx0Ly9UaGUgdXNlcm5hbWUgaXMgdXNlZCBhcyBwYXJ0IG9mIHRoZSB1c2VycyBsb2dpbiB0b2tlbiwgc28gaWYgdGhlIHVzZXJuYW1lIGNoYW5nZXMgdGhlIHRva2VuIGlzIG5vIGxvbmdlciB2YWxpZCAodGhpcyBpcyBuZWVkZWQgZm9yIHNlY3VyaXR5IHJlYXNvbnMpXG5cdFx0XHRcdFx0Ly90aGVyZWZvcmUgY2hhbmdpbmcgYSB1c2VybmFtZSB3aWxsIGVmZmVjdGl2ZWx5IGxvZyBzb21lb25lIG91dC4gXG5cdFx0XHRcdFx0Ly9TbyB3ZSBuZWVkIHRvIGNoZWNrIGlmIHRoZWlyIHVzZXJuYW1lIHdhcyBjaGFuZ2VkLCBhbmQgaWYgaXQgd2FzIHRoZW4gc2VuZCB0aGVtIHRvIHRoZSBsb2dpbiBwYWdlIHNvIHRoZXkgY2FuIGxvZyBpbnRvIHRoZXkgYWNjb3VudCBhZ2lhbiBhbmQgZ2V0IGEgbmV3IHRva2VuXG5cdFx0XHRcdFx0aWYgKHVzZXIudXNlcm5hbWUgIT0gJHNjb3BlLnVzZXJfcHJvZmlsZS51c2VybmFtZSkge1xuXHRcdFx0XHRcdFx0JHNjb3BlLnJldHVybk1lc3NhZ2UgPSBcIllvdXIgdXNlcm5hbWUgd2FzIGNoYW5nZWQgc28geW91IG11c3QgbG9nIGluIGFnYWluXCI7XG5cdFx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IFxuXHRcdFx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24uaHJlZj0gJy8jL2xvZ2luJztcblx0XHRcdFx0XHRcdH0sIDE1MDApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRlbHNlIHtcblx0XHRcdFx0XHRcdCRzY29wZS5yZXR1cm5NZXNzYWdlID0gXCJEZXRhaWxzIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5XCI7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHR9KVxuXHRcdH1cblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8gRW5kIHByb2ZpbGUgZWRpdCBvcHRpb25zIFxuXHRcdC8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblx0fV0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5jb250cm9sbGVyKCdSZWdpc3RlckN0cmwnICwgW1wiJHNjb3BlXCIgLCBcIlVzZXJTdmNcIiAsIGZ1bmN0aW9uICgkc2NvcGUsIFVzZXJTdmMpIHtcblx0XHQkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkLCBwYXNzd29yZF9jb25maXJtKSB7XG5cdFx0XHRpZiAocGFzc3dvcmQgIT0gcGFzc3dvcmRfY29uZmlybSkge1xuXHRcdFx0XHQkc2NvcGUudmFsaWRhdGlvbk1lc3NhZ2UgPSAnWW91ciBwYXNzd29yZHMgZGlkIG5vdCBtYXRjaC4nO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHRVc2VyU3ZjLnJlZ2lzdGVyKHVzZXJuYW1lLCBwYXNzd29yZClcblx0XHR9XG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29uZmlnKFtcIiRyb3V0ZVByb3ZpZGVyXCIsIGZ1bmN0aW9uICgkcm91dGVQcm92aWRlcikge1xuXHRcdCRyb3V0ZVByb3ZpZGVyXG5cdFx0XHQud2hlbignLycgLCB7Y29udHJvbGxlcjogJ1Bvc3RzQ3RybCcsIHRlbXBsYXRlVXJsOiAncG9zdC9hbGxQb3N0cy5odG1sJ30pXG5cdFx0XHQvLy53aGVuKCcvcmVnaXN0ZXInICwge2NvbnRyb2xsZXI6ICdSZWdpc3RlckN0cmwnLCB0ZW1wbGF0ZVVybDogJ3JlZ2lzdGVyLmh0bWwnfSlcblx0XHRcdC53aGVuKCcvbG9naW4nICwge2NvbnRyb2xsZXI6ICdMb2dpbkN0cmwnLCB0ZW1wbGF0ZVVybDogJ2xvZ2luLmh0bWwnfSlcblx0XHRcdC53aGVuKCcvcG9zdC86eWVhci86bW9udGgvOmRheS86c2x1ZycgLCB7Y29udHJvbGxlcjogJ1NpbmdsZVBvc3RDdHJsJywgdGVtcGxhdGVVcmw6ICdwb3N0L3NpbmdsZVBvc3QuaHRtbCd9KVxuXHRcdFx0LndoZW4oJy9wb3N0L2lkLzppZCcgLCB7Y29udHJvbGxlcjogJ1NpbmdsZVBvc3RDdHJsJywgdGVtcGxhdGVVcmw6ICdzaW5nbGVQb3N0Lmh0bWwnfSlcblx0XHRcdC53aGVuKCcvcG9zdC9uZXcvJyAsIHtjb250cm9sbGVyOiAnUG9zdHNDdHJsJywgdGVtcGxhdGVVcmw6ICdwb3N0L25ld1Bvc3QuaHRtbCd9KVxuXHRcdFx0LndoZW4oJy91c2VyLzp1c2VybmFtZScgLCB7Y29udHJvbGxlcjogJ1Byb2ZpbGVDdHJsJywgdGVtcGxhdGVVcmw6ICdwb3N0L3VzZXJQb3N0cy5odG1sJ30pXG5cdFx0XHQud2hlbignL3RhZy86dGFnJyAsIHtjb250cm9sbGVyOiAnVGFnQ3RybCcsIHRlbXBsYXRlVXJsOiAncG9zdC90YWdQYWdlLmh0bWwnfSlcblx0XHRcdC8vLndoZW4oJy91c2VyLzp1c2VybmFtZS9lZGl0JyAsIHtjb250cm9sbGVyOiAnUHJvZmlsZUN0cmwnLCB0ZW1wbGF0ZVVybDogJ3Byb2ZpbGUvdXNlclByb2ZpbGUuaHRtbCd9KVxuXHRcdFx0Ly8ud2hlbignL3VzZXIvOnVzZXJuYW1lL3Byb2ZpbGUnICwge2NvbnRyb2xsZXI6ICdQcm9maWxlQ3RybCcsIHRlbXBsYXRlVXJsOiAncHJvZmlsZS91c2VyVmlldy5odG1sJ30pXG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29udHJvbGxlcignU2luZ2xlUG9zdEN0cmwnLCBbXCIkc2NvcGVcIiAsIFwiJGh0dHBcIiwgXCJQb3N0c1NlcnZpY2VcIiwgXCIkcm91dGVQYXJhbXNcIiwgXCIkcm91dGVcIiwgXCIkbG9jYXRpb25cIiAsIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCBQb3N0c1NlcnZpY2UsICRyb3V0ZVBhcmFtcywgJHJvdXRlLCAkbG9jYXRpb24pIHtcblxuXHRcdCRzY29wZS5zaW5nbGVQb3N0VmlldyA9IHRydWU7IC8vIG1ha2VzIGl0IGEgYml0IGVhc2llciB0byBjaGFuZ2UgdGhlIHN0eWxpbmcgb2YgdGhlIHBvc3Qgb24gaXRzIHNpbmdsZSBwb3N0IHBhZ2Ugd2hpbGUgdXNpbmcgdGhlIHNhbWUgdGVtcGxhdGUgYXMgdGhlIG11bHRpIHBvc3Qgc3VtbWFyeSBwYWdlc1xuXG5cdFx0JHNjb3BlLiRvbignJHZpZXdDb250ZW50TG9hZGVkJywgZnVuY3Rpb24oKXtcblx0XHRcdC8vdGhlIHBhZ2UgaXMgcmVhZHlcblx0XHR9KTtcblxuXHRcdCRzY29wZS5kZWxldGVJdGVtID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0UG9zdHNTZXJ2aWNlLnJlbW92ZUl0ZW0oe1xuXHRcdFx0XHRcdHBvc3RfaWQ6ICRzY29wZS5wb3N0Ll9pZFxuXHRcdFx0XHR9KVxuXHRcdFx0XHQuc3VjY2VzcyhmdW5jdGlvbiAocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhyZXNwb25zZSk7XG5cdFx0XHRcdFx0Ly8gY29uZmlybSBzdWNjZXNzZnVsIGRlbGV0ZVxuXHRcdFx0XHR9KVxuXHRcdH07XG5cbiAgICAgICAgdmFyIHBvc3RTbHVnID0gJHJvdXRlUGFyYW1zLnNsdWc7XG4gICAgICAgIHZhciBwb3N0SUQgPSAkcm91dGVQYXJhbXMuaWQ7XG5cblx0XHRpZiAocG9zdFNsdWcpIHtcbiAgICAgICAgICAgIHZhciBmdWxsUG9zdFNsdWcgPSAnJztcbiAgICAgICAgICAgIGZ1bGxQb3N0U2x1ZyArPSAkcm91dGVQYXJhbXMueWVhciArICcvJztcbiAgICAgICAgICAgIGZ1bGxQb3N0U2x1ZyArPSAkcm91dGVQYXJhbXMubW9udGggKyAnLyc7XG4gICAgICAgICAgICBmdWxsUG9zdFNsdWcgKz0gJHJvdXRlUGFyYW1zLmRheSArICcvJztcbiAgICAgICAgICAgIGZ1bGxQb3N0U2x1ZyArPSAkcm91dGVQYXJhbXMuc2x1ZztcblxuICAgICAgICAgICAgUG9zdHNTZXJ2aWNlLnNpbmdsZV9zbHVnKHtcblx0XHRcdFx0c2x1ZzogZnVsbFBvc3RTbHVnXG5cdFx0XHR9KVxuXHRcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24gKHBvc3QpIHtcblx0XHRcdFx0JHNjb3BlLnBvc3QgPSBwb3N0WzBdO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5wb3N0KTtcbiAgICAgICAgICAgIH0pXG5cdFx0fVxuXHRcdGVsc2UgaWYgKHBvc3RJRCkge1xuXHRcdFx0UG9zdHNTZXJ2aWNlLnNpbmdsZV9pZCh7XG5cdFx0XHRcdGlkOiBwb3N0SURcblx0XHRcdH0pXHRcdFxuXHRcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24gKHBvc3QpIHtcblx0XHRcdFx0JHNjb3BlLnBvc3QgPSBwb3N0WzBdO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5wb3N0KTtcblx0XHRcdH0pXG5cdFx0fVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIHRoZSB1cmwgZG9lcyBub3QgY29udGFpbiBhIHZhbGlkIHBvc3Qgc2x1ZyBvciBpZFxuICAgICAgICAgICAgLy8gc2hvdyBlcnJvciB0byB1c2VyXG4gICAgICAgIH1cblxuXHR9XSkiLCIvKipcbiAqIENyZWF0ZWQgYnkgdG9taSBvbiAwNS8wMy8xNi5cbiAqL1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgICAuY29udHJvbGxlcignVGFnQ3RybCcsIFtcIiRzY29wZVwiICwgXCIkaHR0cFwiLCBcIlVzZXJTdmNcIiwgXCJQb3N0c1NlcnZpY2VcIiAsIFwiJHJvdXRlUGFyYW1zXCIsIFwiJHJvdXRlXCIsIFwiJGxvY2F0aW9uXCIgLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgVXNlclN2YywgUG9zdHNTZXJ2aWNlLCAkcm91dGVQYXJhbXMsICRyb3V0ZSwgJGxvY2F0aW9uKSB7XG5cbiAgICAgICAgJHNjb3BlLmJhc2VVcmwgPSBsb2NhdGlvbi5ob3N0O1xuICAgICAgICB2YXIgdGFnID0gJHJvdXRlUGFyYW1zLnRhZztcbiAgICAgICAgJHNjb3BlLm5ldyAgPSB7fTtcblxuICAgICAgICAkc2NvcGUudGFnVGl0bGUgPSB0YWc7XG5cbiAgICAgICAgUG9zdHNTZXJ2aWNlLmZpbHRlcmVkX3Bvc3RzICh7XG4gICAgICAgICAgICAgICAgdGFnczogdGFnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKHRhZ2dlZFBvc3RzKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnBvc3RzID0gdGFnZ2VkUG9zdHM7XG4gICAgICAgICAgICB9KTtcbiAgICB9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcblx0LnNlcnZpY2UoJ1VzZXJTdmMnLCBbXCIkaHR0cFwiLCBmdW5jdGlvbigkaHR0cCkge1xuXHRcdHZhciBzdmMgPSB0aGlzO1xuXG5cdFx0c3ZjLmdldFVzZXIgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHQkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSB3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuXG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzJylcblx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgXHRcdFx0cmV0dXJuIHJlc3BvbnNlXG4gICAgXHRcdH0pXG5cdFx0fVxuXG5cdFx0c3ZjLmxvZ2luID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuXHRcdFx0cmV0dXJuICRodHRwLnBvc3QoJy9hcGkvc2Vzc2lvbnMnLCB7XG5cdFx0XHRcdHVzZXJuYW1lOiB1c2VybmFtZSwgcGFzc3dvcmQ6IHBhc3N3b3JkXG5cdFx0XHR9KVxuXHRcdFx0LnRoZW4oZnVuY3Rpb24gKHZhbCkge1xuXHRcdFx0XHR3aW5kb3cubG9jYWxTdG9yYWdlLnRva2VuID0gdmFsLmRhdGE7XG5cdFx0XHRcdCRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXSA9IHZhbC5kYXRhXG5cdFx0XHRcdHJldHVybiBzdmMuZ2V0VXNlcigpO1xuXHRcdFx0fSlcblx0XHR9XG5cblx0XHRzdmMucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkLCBwYXNzd29yZF9jb25maXJtKSB7XG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS91c2VycycsIHtcblx0XHRcdFx0dXNlcm5hbWU6IHVzZXJuYW1lLCBwYXNzd29yZDogcGFzc3dvcmRcblx0XHRcdH0pXG5cdFx0XHQudGhlbihmdW5jdGlvbiAodmFsKSB7XG5cdFx0XHRcdHJldHVybiBzdmMubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKVxuXHRcdFx0XHRcdC50aGVuKGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24uaHJlZj0gJy8nO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHR9KVxuXHRcdH1cblxuXHRcdHN2Yy5hdXRob3JpemF0aW9uID0gZnVuY3Rpb24gKHBlcm1pc3Npb25fbGV2ZWwpIHtcblx0XHRcdCRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW47XG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzL3Blcm1pc3Npb25zJylcblx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhyZXNwb25zZSk7XG5cdFx0XHRcdGlmIChyZXNwb25zZS5kYXRhID4gcGVybWlzc2lvbl9sZXZlbCkge1xuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH0pXG5cdFx0fVxuXG5cdFx0c3ZjLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndG9rZW4nKTtcblx0XHRcdHdpbmRvdy5sb2NhdGlvbi5ocmVmPSAnLyc7XG5cdFx0fVxuXG5cdFx0c3ZjLnByb2ZpbGUgPSBmdW5jdGlvbiAodXNlcm5hbWUpIHtcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMvcHJvZmlsZScsIHsgcGFyYW1zOiB7dXNlcm5hbWU6IHVzZXJuYW1lfSB9KVxuXHRcdH1cblxuXHRcdHN2Yy5wcm9maWxlVXBkYXRlID0gZnVuY3Rpb24gKHByb2ZpbGUpIHtcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzL3Byb2ZpbGUnLCBwcm9maWxlIClcblx0XHR9XG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLnJ1bihbXCIkcm9vdFNjb3BlXCIsIFwiJHRpbWVvdXRcIiAsIFwiJHdpbmRvd1wiICwgZnVuY3Rpb24gKCRyb290U2NvcGUsICR0aW1lb3V0LCAkd2luZG93KSB7XG5cblx0dmFyIHJlY29ubmVjdF9kZWxheSA9IDEwO1xuXHRcblx0KGZ1bmN0aW9uIGNvbm5lY3QoKXtcblx0XHQvL2luY3JlbWVudCB0aGUgcmVjb25uZWN0IGRlbGF5IHRpbWVlclxuXHRcdHJlY29ubmVjdF9kZWxheSArPSByZWNvbm5lY3RfZGVsYXk7XG5cblx0XHQvL0NyZWF0ZSBhIHdlYnNvY2tldCBjb25uZWN0aW9uIHdpdGggdGhlIHNlcnZlclxuXHRcdHZhciBob3N0ID0gXCJ3czovL1wiICsgJHdpbmRvdy5sb2NhdGlvbi5ob3N0XG5cdFx0ICBcblx0XHR2YXIgY29ubmVjdGlvbiA9IG5ldyBXZWJTb2NrZXQoaG9zdClcblxuXHRcdGNvbm5lY3Rpb24ub25vcGVuID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0Ly9jb25zb2xlLmxvZygnV2Vic29ja2V0IGNvbm5lY3RlZCcpXG5cdFx0fVxuXG5cblx0XHRjb25uZWN0aW9uLm9uY2xvc2UgPSBmdW5jdGlvbiAoZSkge1xuXHRcdFx0Y29uc29sZS5sb2coJ1dlYnNvY2tldCBjb25uZWN0aW9uIGNsb3NlZC4gQXR0ZW1wdGluZyB0byByZWNjb25uZWN0IGluICcgKyByZWNvbm5lY3RfZGVsYXkgKyAnIHNlY29uZHMnIClcblxuXHRcdFx0JHRpbWVvdXQoY29ubmVjdCwgcmVjb25uZWN0X2RlbGF5KjEwMDApO1xuXHRcdH0gXG5cblx0XHRjb25uZWN0aW9uLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHQvL2NvbnNvbGUubG9nKGUpO1xuXHRcdFx0dmFyIG1lc3NhZ2UgPSBKU09OLnBhcnNlKGUuZGF0YSk7XG5cdFx0XHRcblx0XHRcdHZhciBuYW1lID0gJ3dzOicgKyBtZXNzYWdlLnRvcGljO1xuXHRcdFx0dmFyIGRhdGEgPSBtZXNzYWdlLmRhdGE7XG5cdFx0XHQvL2NvbnNvbGUubG9nKFwiYnJvYWRjYXN0aW5nOiBcIik7XG5cblx0XHRcdCRyb290U2NvcGUuJGJyb2FkY2FzdChuYW1lLCBkYXRhKTtcblx0XHR9XG5cdH0pKClcbn1dKSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==