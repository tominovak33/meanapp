angular.module("app",["ngRoute","ngAnimate"]),angular.module("app").controller("ApplicationCtrl",["$scope","$rootScope","UserSvc",function(e,t,n){e.baseUrl=location.host,window.localStorage.token&&n.getUser().then(function(t){e.$emit("userLoggedIn",t.data)}),e.$on("userLoggedIn",function(t,n){e.currentUser=n})}]).filter("output_html",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("startFrom",function(){return function(e,t){return e?(t=+t,e.slice(t)):[]}}),angular.module("app").controller("LoginCtrl",["$scope","UserSvc",function(e,t){e.login=function(n,o){t.login(n,o).then(function(t){e.$emit("userLoggedIn",t.data),window.location.href="#/"},function(t){e.loginValidation="Incorrect username & password combination"})},e.logout=function(){t.logout()}}]),angular.module("app").controller("PostsCtrl",["$scope","$http","PostsService","filterFilter",function(e,t,n,o){e.baseUrl=location.host,e.bodyLengthLimit=250,e.posts=[],e.addPost=function(){var t=CKEDITOR.instances.editor1.getData(),o=e.urlDate(),r=e.slugify(e.postTitle),s=o+r;t&&n.send({body:t,title:e.postTitle,slug:s}).success(function(t){e.postBody=null,CKEDITOR.instances.editor1.setData(""),e.postTitle=null})},e.init_ckedit=function(){CKEDITOR.replace("editor1")},e.$on("ws:new_post",function(t,n){n=n[0],e.$apply(function(){e.posts.unshift(n),e.paginate()})}),e.$on("$viewContentLoaded",function(){}),e.currentPage=1,e.postsPerPage=5,e.prevPage=function(){e.currentPage>1&&e.currentPage--},e.nextPage=function(){e.currentPage<e.posts.length/e.postsPerPage&&e.currentPage++},e.setPage=function(t){e.currentPage=t},e.range=function(e){return new Array(e)},e.$watch("search",function(t){e.filteredPosts=o(e.posts,t),e.paginate(e.filteredPosts.length)},!0),e.paginate=function(t){e.numberOfPages=Math.ceil(t>0?t/e.postsPerPage:e.posts.length/e.postsPerPage)},e.urlDate=function(e){if(void 0===e)var t=new Date;else var t=new Date(e);var n=t.getDate(),o=t.getMonth()+1,r=t.getFullYear(),s=String(r)+"-"+String(o)+"-"+String(n)+"-";return s},e.slugify=function(e){var t=e.toLowerCase();return t=t.replace(/\s+/g,"_"),t=t.replace(/\?/g,""),t=t.replace(/\&/g,""),t=t.replace(/\=/g,"")},n.get().success(function(t){e.posts=t,e.paginate(e.posts.length)})}]),angular.module("app").service("PostsService",["$http",function(e){this.get=function(){return e.get("/api/posts")},this.send=function(t){return e.post("/api/posts",t)},this.removeItem=function(t){return e.post("/api/posts/removeItem",{params:{post_id:t.post_id}})},this.single_slug=function(t){return e.get("/api/posts",{params:{post_slug:t.slug}})},this.single_id=function(t){return e.get("/api/posts",{params:{post_id:t.id}})},this.user_posts=function(t){return e.get("/api/posts",{params:{_author:t._author}})}}]),angular.module("app").controller("ProfileCtrl",["$scope","$http","UserSvc","PostsService","$routeParams","$route","$location",function(e,t,n,o,r,s,i){e.editPermission=function(t){n.authorization().then(function(t){e=t})},e.baseUrl=location.host;var a=r.username;e["new"]={},n.profile(a).success(function(t){e.user_profile=t,o.user_posts({_author:e.user_profile._id}).success(function(t){e.user_posts=t,e.paginate(e.user_posts.length)})}),e.checkLogin=function(){window.localStorage.token&&n.getUser().then(function(t){e.currentUser=t.data,(e.user_profile._id==e.currentUser._id||e.editPermission(e.currentUser.permission_level))&&(e.canEdit=!0)})},e.currentUser=[],e.checkLogin(),e.$on("$viewContentLoaded",function(){}),e.user_posts=[],e.currentPage=1,e.postsPerPage=5,e.prevPage=function(){e.currentPage>1&&e.currentPage--},e.nextPage=function(){e.currentPage<e.user_posts.length/e.postsPerPage&&e.currentPage++},e.setPage=function(t){e.currentPage=t},e.range=function(e){return new Array(e)},e.paginate=function(t){e.numberOfPages=Math.ceil(t>0?t/e.postsPerPage:e.user_posts.length/e.postsPerPage)},e.range=function(e){return new Array(e)},n.authorization("10").then(function(e){console.log(e)}),e.saveProfile=function(){var t={_id:e.user_profile._id};for(var o in e["new"])e["new"].hasOwnProperty(o)&&""!=e["new"][o]&&(t[o]=e["new"][o]);n.profileUpdate(t).success(function(t){t.username!=e.user_profile.username?(e.returnMessage="Your username was changed so you must log in again",setTimeout(function(){window.location.href="/#/login"},1500)):e.returnMessage="Details updated successfully"})}}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc",function(e,t){e.register=function(n,o,r){return o!=r?void(e.validationMessage="Your passwords did not match."):void t.register(n,o)}}]),angular.module("app").config(["$routeProvider",function(e){e.when("/",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"}).when("/logout",{controller:"LoginCtrl",templateUrl:"logout.html"}).when("/post/:slug",{controller:"SinglePostCtrl",templateUrl:"singlePost.html"}).when("/post/id/:id",{controller:"SinglePostCtrl",templateUrl:"singlePost.html"}).when("/user/:username",{controller:"ProfileCtrl",templateUrl:"user.html"}).when("/user/:username/edit",{controller:"ProfileCtrl",templateUrl:"profile/userProfile.html"})}]),angular.module("app").controller("SinglePostCtrl",["$scope","$http","PostsService","$routeParams","$route","$location",function(e,t,n,o,r,s){var i=o.slug,a=o.id;e.$on("$viewContentLoaded",function(){}),e.deleteItem=function(){n.removeItem({post_id:e.post._id}).success(function(e){console.log(e)})},i?n.single_slug({slug:i}).success(function(t){e.post=t[0]}):n.single_id({id:a}).success(function(t){e.post=t[0]})}]),angular.module("app").service("UserSvc",["$http",function(e){var t=this;t.getUser=function(){return e.defaults.headers.common["X-Auth"]=window.localStorage.token,e.get("/api/users").then(function(e){return e})},t.login=function(n,o){return e.post("/api/sessions",{username:n,password:o}).then(function(n){return window.localStorage.token=n.data,e.defaults.headers.common["X-Auth"]=n.data,t.getUser()})},t.register=function(n,o,r){return e.post("/api/users",{username:n,password:o}).then(function(e){return t.login(n,o).then(function(){window.location.href="/"})})},t.authorization=function(t){return e.defaults.headers.common["X-Auth"]=window.localStorage.token,e.get("/api/users/permissions").then(function(e){return console.log(e),e.data>t?!0:!1})},t.logout=function(){window.localStorage.removeItem("token"),window.location.href="/"},t.profile=function(t){return e.get("/api/users/profile",{params:{username:t}})},t.profileUpdate=function(t){return e.post("/api/users/profile",t)}}]),angular.module("app").run(["$rootScope","$timeout","$window",function(e,t,n){var o=10;!function r(){o+=o;var s="ws://"+n.location.host,i=new WebSocket(s);i.onopen=function(){},i.onclose=function(e){console.log("Websocket connection closed. Attempting to recconnect in "+o+" seconds"),t(r,1e3*o)},i.onmessage=function(t){var n=JSON.parse(t.data),o="ws:"+n.topic,r=n.data;e.$broadcast(o,r)}}()}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uQ3RybC5qcyIsImxvZ2luQ3J0bC5qcyIsInBvc3RzQ3RybC5qcyIsInBvc3RzU2VydmljZS5qcyIsInByb2ZpbGVDdHJsLmpzIiwicmVnaXN0cmF0aW9uQ3RybC5qcyIsInJvdXRlcy5qcyIsInNpbmdsZVBvc3RzQ3RybC5qcyIsInVzZXJTZXJ2aWNlLmpzIiwid2Vic29ja2V0cy5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRyb290U2NvcGUiLCJVc2VyU3ZjIiwiYmFzZVVybCIsImxvY2F0aW9uIiwiaG9zdCIsIndpbmRvdyIsImxvY2FsU3RvcmFnZSIsInRva2VuIiwiZ2V0VXNlciIsInRoZW4iLCJyZXNwb25zZSIsIiRlbWl0IiwiZGF0YSIsIiRvbiIsImV2ZW50IiwidXNlciIsImN1cnJlbnRVc2VyIiwiZmlsdGVyIiwiJHNjZSIsInZhbCIsInRydXN0QXNIdG1sIiwiaW5wdXQiLCJzdGFydCIsInNsaWNlIiwibG9naW4iLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwiaHJlZiIsImVycm9yIiwibG9naW5WYWxpZGF0aW9uIiwibG9nb3V0IiwiJGh0dHAiLCJQb3N0c1NlcnZpY2UiLCJmaWx0ZXJGaWx0ZXIiLCJib2R5TGVuZ3RoTGltaXQiLCJwb3N0cyIsImFkZFBvc3QiLCJja2VkaXRvcl9jb250ZW50IiwiQ0tFRElUT1IiLCJpbnN0YW5jZXMiLCJlZGl0b3IxIiwiZ2V0RGF0YSIsImRhdGVfc2x1ZyIsInVybERhdGUiLCJ0aXRsZV9zbHVnIiwic2x1Z2lmeSIsInBvc3RUaXRsZSIsInNsdWciLCJzZW5kIiwiYm9keSIsInRpdGxlIiwic3VjY2VzcyIsInBvc3QiLCJwb3N0Qm9keSIsInNldERhdGEiLCJpbml0X2NrZWRpdCIsInJlcGxhY2UiLCJfIiwiJGFwcGx5IiwidW5zaGlmdCIsInBhZ2luYXRlIiwiY3VycmVudFBhZ2UiLCJwb3N0c1BlclBhZ2UiLCJwcmV2UGFnZSIsIm5leHRQYWdlIiwibGVuZ3RoIiwic2V0UGFnZSIsInBhZ2VfbnVtYmVyIiwicmFuZ2UiLCJuIiwiQXJyYXkiLCIkd2F0Y2giLCJ0ZXJtIiwiZmlsdGVyZWRQb3N0cyIsIm51bWJlcl9vZl9pdGVtcyIsIm51bWJlck9mUGFnZXMiLCJNYXRoIiwiY2VpbCIsInRpbWUiLCJ1bmRlZmluZWQiLCJkYXRlIiwiRGF0ZSIsImRheSIsImdldERhdGUiLCJtb250aCIsImdldE1vbnRoIiwieWVhciIsImdldEZ1bGxZZWFyIiwidXJsX2RhdGUiLCJTdHJpbmciLCJzdHJpbmciLCJ0b0xvd2VyQ2FzZSIsImdldCIsInNlcnZpY2UiLCJ0aGlzIiwicmVtb3ZlSXRlbSIsInBhcmFtZXRlcnMiLCJwYXJhbXMiLCJwb3N0X2lkIiwic2luZ2xlX3NsdWciLCJwb3N0X3NsdWciLCJzaW5nbGVfaWQiLCJpZCIsInVzZXJfcG9zdHMiLCJfYXV0aG9yIiwiJHJvdXRlUGFyYW1zIiwiJHJvdXRlIiwiJGxvY2F0aW9uIiwiZWRpdFBlcm1pc3Npb24iLCJwZXJtaXNzaW9uX2xldmVsIiwiYXV0aG9yaXphdGlvbiIsInByb2ZpbGUiLCJ1c2VyX3Byb2ZpbGUiLCJfaWQiLCJjaGVja0xvZ2luIiwiY2FuRWRpdCIsImNvbnNvbGUiLCJsb2ciLCJzYXZlUHJvZmlsZSIsInByb2ZpbGVfZGV0YWlscyIsImtleSIsImhhc093blByb3BlcnR5IiwicHJvZmlsZVVwZGF0ZSIsInJldHVybk1lc3NhZ2UiLCJzZXRUaW1lb3V0IiwicmVnaXN0ZXIiLCJwYXNzd29yZF9jb25maXJtIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImRlbGV0ZUl0ZW0iLCJzdmMiLCJkZWZhdWx0cyIsImhlYWRlcnMiLCJjb21tb24iLCJydW4iLCIkdGltZW91dCIsIiR3aW5kb3ciLCJyZWNvbm5lY3RfZGVsYXkiLCJjb25uZWN0IiwiY29ubmVjdGlvbiIsIldlYlNvY2tldCIsIm9ub3BlbiIsIm9uY2xvc2UiLCJlIiwib25tZXNzYWdlIiwibWVzc2FnZSIsIkpTT04iLCJwYXJzZSIsIm5hbWUiLCJ0b3BpYyIsIiRicm9hZGNhc3QiXSwibWFwcGluZ3MiOiJBQUNBQSxRQUFBQyxPQUFBLE9BQUEsVUFBQSxjQ0RBRCxRQUFBQyxPQUFBLE9BQ0FDLFdBQUEsbUJBQUEsU0FBQSxhQUFBLFVBQUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FNQUYsRUFBQUcsUUFBQUMsU0FBQUMsS0FHQUMsT0FBQUMsYUFBQUMsT0FDQU4sRUFBQU8sVUFDQUMsS0FBQSxTQUFBQyxHQUNBWCxFQUFBWSxNQUFBLGVBQUFELEVBQUFFLFFBSUFiLEVBQUFjLElBQUEsZUFBQSxTQUFBQyxFQUFBQyxHQUNBaEIsRUFBQWlCLFlBQUFELE9BSUFFLE9BQUEsZUFBQSxPQUFBLFNBQUFDLEdBQ0EsTUFBQSxVQUFBQyxHQUNBLE1BQUFELEdBQUFFLFlBQUFELE9BSUFGLE9BQUEsWUFBQSxXQUNBLE1BQUEsVUFBQUksRUFBQUMsR0FDQSxNQUFBRCxJQUNBQyxHQUFBQSxFQUNBRCxFQUFBRSxNQUFBRCxVQ2hDQTFCLFFBQUFDLE9BQUEsT0FDQUMsV0FBQSxhQUFBLFNBQUEsVUFBQSxTQUFBQyxFQUFBRSxHQUNBRixFQUFBeUIsTUFBQSxTQUFBQyxFQUFBQyxHQUNBekIsRUFBQXVCLE1BQUFDLEVBQUFDLEdBQ0FqQixLQUFBLFNBQUFDLEdBQ0FYLEVBQUFZLE1BQUEsZUFBQUQsRUFBQUUsTUFDQVAsT0FBQUYsU0FBQXdCLEtBQUEsTUFFQSxTQUFBQyxHQUNBN0IsRUFBQThCLGdCQUFBLCtDQUtBOUIsRUFBQStCLE9BQUEsV0FDQTdCLEVBQUE2QixhQ2ZBbEMsUUFBQUMsT0FBQSxPQUNBQyxXQUFBLGFBQUEsU0FBQSxRQUFBLGVBQUEsZUFBQSxTQUFBQyxFQUFBZ0MsRUFBQUMsRUFBQUMsR0FDQWxDLEVBQUFHLFFBQUFDLFNBQUFDLEtBQ0FMLEVBQUFtQyxnQkFBQSxJQUVBbkMsRUFBQW9DLFNBQ0FwQyxFQUFBcUMs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QUcsRUFBQSxJQUFBRCxJQUdBRSxFQUFBSyxVQUFBLFNBQUFELEdBRUEsR0FBQUUsR0FBQUMsS0FBQUMsTUFBQUosRUFBQXRJLE1BRUEySSxFQUFBLE1BQUFILEVBQUFJLE1BQ0E1SSxFQUFBd0ksRUFBQXhJLElBR0FaLEdBQUF5SixXQUFBRixFQUFBM0kiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9UaGlzIGZpbGUgbXVzdCBiZSB0aGUgZmlyc3QgaW4gdGhlIGxpc3QgdG8gYmUgY29uY2F0ZW5hdGVkXG5hbmd1bGFyLm1vZHVsZSgnYXBwJywgWyduZ1JvdXRlJywgJ25nQW5pbWF0ZSddKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29udHJvbGxlcignQXBwbGljYXRpb25DdHJsJyAsIFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCJVc2VyU3ZjXCIsIGZ1bmN0aW9uICgkc2NvcGUsICRyb290U2NvcGUsIFVzZXJTdmMpIHtcblx0XHQvKlxuXHRcdElmIHdlIGhhdmUgYSBzdG9yZWQgdG9rZW4sIGdldCB0aGUgdXNlciBpbmZvcm1hdGlvbiBmcm9tIGl0XG5cdFx0YW5kIGVtaXQgdGhlIHVzZXIgbG9nZ2VkaW4gbWVzc2FnZXMgaW4gb3JkZXIgdG8gYWxsb3cgdGhlIFVJIHRvIFxuXHRcdGluZGljYXRlIHRvIHRoZSB1c2VyIHRoYXQgdGhleSB3ZXJlIGxvZ2dlZCBpblxuXHRcdCovXG5cdFx0JHNjb3BlLmJhc2VVcmwgPSBsb2NhdGlvbi5ob3N0O1xuXG5cdFx0XG5cdFx0aWYgKHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW4pIHtcblx0XHRcdFVzZXJTdmMuZ2V0VXNlcigpXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSl7XG5cdFx0XHRcdFx0JHNjb3BlLiRlbWl0KCd1c2VyTG9nZ2VkSW4nLCByZXNwb25zZS5kYXRhKTtcblx0XHRcdFx0fSlcblx0XHR9XG5cblx0XHQkc2NvcGUuJG9uKCd1c2VyTG9nZ2VkSW4nLCBmdW5jdGlvbihldmVudCwgdXNlcikge1xuXHRcdFx0JHNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcblx0XHR9KVxuXHR9XSlcblxuXHQuZmlsdGVyKCdvdXRwdXRfaHRtbCcsIFtcIiRzY2VcIiwgZnVuY3Rpb24gKCRzY2UpIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24odmFsKSB7XG5cdCAgICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc0h0bWwodmFsKTtcblx0ICAgIH07XG5cdH1dKVxuXG5cdC5maWx0ZXIoJ3N0YXJ0RnJvbScsIGZ1bmN0aW9uKCkge1xuXHQgICAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0LCBzdGFydCkge1xuXHQgICAgICAgIGlmKGlucHV0KSB7XG5cdCAgICAgICAgICAgIHN0YXJ0ID0gK3N0YXJ0OyAvL3BhcnNlIHRvIGludFxuXHQgICAgICAgICAgICByZXR1cm4gaW5wdXQuc2xpY2Uoc3RhcnQpO1xuXHQgICAgICAgIH1cblx0ICAgICAgICByZXR1cm4gW107XG5cdCAgICB9XG5cdH0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29udHJvbGxlcignTG9naW5DdHJsJyAsIFtcIiRzY29wZVwiICwgXCJVc2VyU3ZjXCIgLCBmdW5jdGlvbiAoJHNjb3BlLCBVc2VyU3ZjKSB7XG5cdFx0JHNjb3BlLmxvZ2luID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuXHRcdFx0VXNlclN2Yy5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSl7XG5cdFx0XHRcdFx0JHNjb3BlLiRlbWl0KCd1c2VyTG9nZ2VkSW4nLCByZXNwb25zZS5kYXRhKTtcblx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcjLydcblx0XHRcdFx0fSxcblx0XHRcdFx0ZnVuY3Rpb24oZXJyb3Ipe1xuXHRcdFx0XHQgICRzY29wZS5sb2dpblZhbGlkYXRpb24gPSAnSW5jb3JyZWN0IHVzZXJuYW1lICYgcGFzc3dvcmQgY29tYmluYXRpb24nO1xuXHRcdFx0XHR9KVxuXG5cdFx0fVxuXG5cdFx0JHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFVzZXJTdmMubG9nb3V0KClcblx0XHR9XG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29udHJvbGxlcignUG9zdHNDdHJsJywgW1wiJHNjb3BlXCIgLCBcIiRodHRwXCIsIFwiUG9zdHNTZXJ2aWNlXCIsIFwiZmlsdGVyRmlsdGVyXCIsIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCBQb3N0c1NlcnZpY2UsIGZpbHRlckZpbHRlcikge1xuXHRcdCRzY29wZS5iYXNlVXJsID0gbG9jYXRpb24uaG9zdDtcblx0XHQkc2NvcGUuYm9keUxlbmd0aExpbWl0ID0gMjUwO1xuXG5cdFx0JHNjb3BlLnBvc3RzID0gW107XG5cdFx0JHNjb3BlLmFkZFBvc3QgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHR2YXIgY2tlZGl0b3JfY29udGVudCA9IENLRURJVE9SLmluc3RhbmNlcy5lZGl0b3IxLmdldERhdGEoKTtcblx0XHRcdHZhciBkYXRlX3NsdWcgPSAkc2NvcGUudXJsRGF0ZSgpO1xuXHRcdFx0dmFyIHRpdGxlX3NsdWcgPSAkc2NvcGUuc2x1Z2lmeSgkc2NvcGUucG9zdFRpdGxlKTtcblxuXHRcdFx0dmFyIHNsdWcgPSBkYXRlX3NsdWcgKyB0aXRsZV9zbHVnO1xuXG5cdFx0XHRpZiAoY2tlZGl0b3JfY29udGVudCkge1xuXHRcdFx0XHRQb3N0c1NlcnZpY2Uuc2VuZCh7XG5cdFx0XHRcdFx0Ym9keTogY2tlZGl0b3JfY29udGVudCxcblx0XHRcdFx0XHR0aXRsZTogJHNjb3BlLnBvc3RUaXRsZSxcblx0XHRcdFx0XHRzbHVnOiBzbHVnXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5zdWNjZXNzKGZ1bmN0aW9uIChwb3N0KSB7XG5cdFx0XHRcdFx0Lypcblx0XHRcdFx0XHQvL1JlbW92ZWQgYXMgd2Vic29ja2V0IGJyb2FkY2FzdCB3b3VsZCBjYXVzZSB0aGUgcG9zdCB0byBhcHBlYXIgZHVwbGljYXRlZCBvbiB0aGUgYnJvd3NlciB0aGF0IGl0IHdhcyBwb3N0ZWQgZnJvbSBcblx0XHRcdFx0XHQvL2FzIGJvdGggb2YgdGhlIGZ1bmN0aW9ucyB3b3VsZCBnZXQgZXhlY3V0ZWQgYmVjYXVzZSB0aGUgY2xpZW50IHdobyBzZW5kcyB0aGUgcG9zdCB3b3VsZCBzdGlsbCByZWNpZXZlIHRoZSB3ZWJzb2NrZXRzIGJyb2FkY2FzdCBiYWNrIGZyb20gdGhlIHNlcnZlciAgXG5cdFx0XHRcdFx0Ki9cblx0XHRcdFx0XHQkc2NvcGUucG9zdEJvZHkgPSBudWxsO1xuXHRcdFx0XHRcdENLRURJVE9SLmluc3RhbmNlcy5lZGl0b3IxLnNldERhdGEoJycpO1xuXHRcdFx0XHRcdCRzY29wZS5wb3N0VGl0bGUgPSBudWxsO1xuXHRcdFx0XHR9KVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdCRzY29wZS5pbml0X2NrZWRpdCA9IGZ1bmN0aW9uICgpIHtcblx0XHQgICAgQ0tFRElUT1IucmVwbGFjZSgnZWRpdG9yMScpO1xuXHRcdH1cblxuXHRcdCRzY29wZS4kb24oJ3dzOm5ld19wb3N0JywgZnVuY3Rpb24oXywgcG9zdCkge1xuXHRcdFx0cG9zdCA9IHBvc3RbMF07XG5cdFx0XHQkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0JHNjb3BlLnBvc3RzLnVuc2hpZnQocG9zdCk7XG5cdFx0XHRcdCRzY29wZS5wYWdpbmF0ZSgpO1xuXHRcdFx0fSlcblx0XHR9KVxuXG5cdFx0JHNjb3BlLiRvbignJHZpZXdDb250ZW50TG9hZGVkJywgZnVuY3Rpb24oKXtcblx0XHRcdC8vdGhlIHBhZ2UgaXMgcmVhZHlcblx0XHR9KTtcblxuXHRcdCRzY29wZS5jdXJyZW50UGFnZSA9IDE7XG5cdFx0JHNjb3BlLnBvc3RzUGVyUGFnZSA9IDU7XG5cblx0XHQkc2NvcGUucHJldlBhZ2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgaWYgKCRzY29wZS5jdXJyZW50UGFnZSA+IDEpIHtcblx0ICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRQYWdlLS07XG5cdCAgICAgICAgfVxuXHQgICAgfTtcbiAgICBcblx0ICAgICRzY29wZS5uZXh0UGFnZSA9IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICBpZiAoJHNjb3BlLmN1cnJlbnRQYWdlIDwgJHNjb3BlLnBvc3RzLmxlbmd0aC8kc2NvcGUucG9zdHNQZXJQYWdlKSB7XG5cdCAgICAgICAgICAgICRzY29wZS5jdXJyZW50UGFnZSsrO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG5cdCAgICBcblx0ICAgICRzY29wZS5zZXRQYWdlID0gZnVuY3Rpb24gKHBhZ2VfbnVtYmVyKSB7XG5cdCAgICAgICAgJHNjb3BlLmN1cnJlbnRQYWdlID0gcGFnZV9udW1iZXI7XG5cdCAgICB9O1xuXG5cdCAgICAvL1RoaXMgd2F5IEkgY2FuIGRvOiAgXCI8bGkgbmctcmVwZWF0PVwibiBpbiByYW5nZShwYWdlcykgdHJhY2sgYnkgJGluZGV4XCI+XCIgYW5kIHNvIEkgY2FuIGRpc3BsYXkgYXMgbWFueSBpdGVtcyBhcyB0aGUgdmFsdWUgb2YgYSBudW1iZXIgYXMgdGhpcyByZXR1cm5zIGFuIGFycmF5IG9mIHRoYXQgbGVuZ2h0XG5cdCAgICAkc2NvcGUucmFuZ2UgPSBmdW5jdGlvbihuKSB7XG4gICAgICAgIFx0cmV0dXJuIG5ldyBBcnJheShuKTtcbiAgICBcdH07XG5cdCAgICBcblx0ICAgIC8vd2F0Y2ggdG8gc2VlIGlmIHNlYXJjaGluZyBhbmQgcmVwYWdpbmF0ZSBpZiB3ZSBhcmVcblx0ICAgIC8vdHJ1ZSBhdCB0aGUgZW5kICBtYWdpY2FsbHkgbWFrZXMgaXQgc28gdGhhdCBhcyBlYWNoIGV4dHJhIGxldHRlciBpcyBhZGRlZCB0byB0aGUgc2VhcmNoIHdlIGNhbiByZXBhZ2luYXRlXG5cdCAgICAvL3dpdGhvdXQgdGhlICd0cnVlJyBpdCBvbmx5IGRpZCAgdGhhdFxuXHQgICAgJHNjb3BlLiR3YXRjaCgnc2VhcmNoJywgZnVuY3Rpb24odGVybSkge1xuXHQgICAgICAgICRzY29wZS5maWx0ZXJlZFBvc3RzID0gZmlsdGVyRmlsdGVyKCRzY29wZS5wb3N0cywgdGVybSk7XG5cdCAgICAgICAgJHNjb3BlLnBhZ2luYXRlKCRzY29wZS5maWx0ZXJlZFBvc3RzLmxlbmd0aCk7XG5cdCAgICB9LCB0cnVlKTtcblxuXG5cdCAgICAkc2NvcGUucGFnaW5hdGUgPSBmdW5jdGlvbihudW1iZXJfb2ZfaXRlbXMpe1xuXHQgICAgXHRpZiAobnVtYmVyX29mX2l0ZW1zID4gMCkge1xuXHQgICAgICAgIFx0JHNjb3BlLm51bWJlck9mUGFnZXMgPSBNYXRoLmNlaWwobnVtYmVyX29mX2l0ZW1zLyRzY29wZS5wb3N0c1BlclBhZ2UpO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBlbHNlIHtcblx0ICAgICAgICBcdCRzY29wZS5udW1iZXJPZlBhZ2VzID0gTWF0aC5jZWlsKCRzY29wZS5wb3N0cy5sZW5ndGgvJHNjb3BlLnBvc3RzUGVyUGFnZSk7XG5cdCAgICAgICAgfVxuXHQgICAgfTtcblxuXHQgICAgJHNjb3BlLnVybERhdGUgPSBmdW5jdGlvbih0aW1lKSB7XG5cdFx0XHRpZiAodGltZSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdHZhciBkYXRlID0gbmV3IERhdGUoKTtcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHR2YXIgZGF0ZSA9IG5ldyBEYXRlKHRpbWUpO1xuXHRcdFx0fVxuXHRcdCAgICB2YXIgZGF5ID0gZGF0ZS5nZXREYXRlKCk7XG5cdFx0ICAgIHZhciBtb250aCA9IGRhdGUuZ2V0TW9udGgoKSsxOyAvLysxIGJlY2F1c2UgbW9udGhzIGFyZSAwIGluZGV4ZWRcblx0XHQgICAgdmFyIHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG5cblx0XHQgICAgdmFyIHVybF9kYXRlID0gIFN0cmluZyh5ZWFyKSArICctJyArIFN0cmluZyhtb250aCkgKyAnLScgKyBTdHJpbmcoZGF5KSArICctJyA7XG5cblx0XHRcdHJldHVybiB1cmxfZGF0ZTtcblxuXHQgICAgfTtcblxuXHQgICAgJHNjb3BlLnNsdWdpZnkgPSBmdW5jdGlvbihzdHJpbmcpIHtcblx0ICAgIFx0dmFyIHNsdWcgPSAgc3RyaW5nLnRvTG93ZXJDYXNlKCk7XG5cdCAgICBcdHNsdWcgPSBzbHVnLnJlcGxhY2UoL1xccysvZyxcIl9cIik7XG5cdCAgICBcdHNsdWcgPSBzbHVnLnJlcGxhY2UoL1xcPy9nLCBcIlwiKTtcblx0ICAgIFx0c2x1ZyA9IHNsdWcucmVwbGFjZSgvXFwmL2csIFwiXCIpO1xuXHQgICAgXHRzbHVnID0gc2x1Zy5yZXBsYWNlKC9cXD0vZywgXCJcIik7XG5cdCAgICBcdHJldHVybiBzbHVnO1xuXHQgICAgfTtcblxuXHRQb3N0c1NlcnZpY2UuZ2V0KClcblx0XHQuc3VjY2VzcyhmdW5jdGlvbiAocG9zdHMpIHtcblx0XHRcdCRzY29wZS5wb3N0cyA9IHBvc3RzO1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhwb3N0cyk7IC8vTG9nIGFsbCB0aGUgcG9zdHMgcmVjaWV2ZWQgZnJvbSB0aGUgc2VydmVyXG5cdFx0XHQkc2NvcGUucGFnaW5hdGUoJHNjb3BlLnBvc3RzLmxlbmd0aCk7XG5cdFx0fSlcblxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcblx0LnNlcnZpY2UoJ1Bvc3RzU2VydmljZScsIFtcIiRodHRwXCIgLCBmdW5jdGlvbiAoJGh0dHApIHtcblx0XHR0aGlzLmdldCA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcG9zdHMnKTtcblx0XHR9XG5cdFx0dGhpcy5zZW5kID0gZnVuY3Rpb24gKHBvc3QpIHtcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Bvc3RzJywgcG9zdCk7XG5cdFx0fVxuXHRcdHRoaXMucmVtb3ZlSXRlbSA9IGZ1bmN0aW9uIChwYXJhbWV0ZXJzKSB7XG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9wb3N0cy9yZW1vdmVJdGVtJywgeyBwYXJhbXM6IHtwb3N0X2lkOiBwYXJhbWV0ZXJzLnBvc3RfaWR9IH0pO1xuXHRcdH1cblx0XHR0aGlzLnNpbmdsZV9zbHVnID0gZnVuY3Rpb24gKHBhcmFtZXRlcnMpIHtcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcG9zdHMnLCB7IHBhcmFtczoge3Bvc3Rfc2x1ZzogcGFyYW1ldGVycy5zbHVnfSB9ICk7XG5cdFx0fVxuXHRcdHRoaXMuc2luZ2xlX2lkID0gZnVuY3Rpb24gKHBhcmFtZXRlcnMpIHtcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcG9zdHMnLCB7IHBhcmFtczoge3Bvc3RfaWQ6IHBhcmFtZXRlcnMuaWR9IH0gKTtcblx0XHR9XG5cdFx0dGhpcy51c2VyX3Bvc3RzID0gZnVuY3Rpb24gKHBhcmFtZXRlcnMpIHtcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcG9zdHMnLCB7IHBhcmFtczoge19hdXRob3I6IHBhcmFtZXRlcnMuX2F1dGhvcn0gfSApO1xuXHRcdH1cblx0fV0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG5cdC5jb250cm9sbGVyKCdQcm9maWxlQ3RybCcsIFtcIiRzY29wZVwiICwgXCIkaHR0cFwiLCBcIlVzZXJTdmNcIiwgXCJQb3N0c1NlcnZpY2VcIiAsIFwiJHJvdXRlUGFyYW1zXCIsIFwiJHJvdXRlXCIsIFwiJGxvY2F0aW9uXCIgLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgVXNlclN2YywgUG9zdHNTZXJ2aWNlLCAkcm91dGVQYXJhbXMsICRyb3V0ZSwgJGxvY2F0aW9uKSB7XG5cblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8gR2V0IHVzZXIgcGVybWlzc2lvbnNcblx0XHQvLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cdFx0JHNjb3BlLmVkaXRQZXJtaXNzaW9uID0gZnVuY3Rpb24ocGVybWlzc2lvbl9sZXZlbCkge1xuXHRcdCAgXHRVc2VyU3ZjLmF1dGhvcml6YXRpb24oKVxuXHRcdFx0XHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2Upe1xuXHRcdFx0XHRcdCRzY29wZT0ocmVzcG9uc2UpO1xuXHRcdFx0XHR9KVxuXHRcdH1cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvIEVuZCB1c2VyIHBlcm1pc3Npb25zXG5cdFx0Ly0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cblx0XHQkc2NvcGUuYmFzZVVybCA9IGxvY2F0aW9uLmhvc3Q7XG5cdFx0dmFyIHVzZXJuYW1lID0gJHJvdXRlUGFyYW1zLnVzZXJuYW1lO1xuXHRcdCRzY29wZS5uZXcgID0ge307XG5cblx0XHRVc2VyU3ZjLnByb2ZpbGUodXNlcm5hbWUpXG5cdFx0XHQuc3VjY2VzcyhmdW5jdGlvbiAodXNlcl9wcm9maWxlKSB7XG5cdFx0XHRcdCRzY29wZS51c2VyX3Byb2ZpbGUgPSB1c2VyX3Byb2ZpbGU7XG5cdFx0XHRcdFBvc3RzU2VydmljZS51c2VyX3Bvc3RzICh7XG5cdFx0XHRcdFx0X2F1dGhvcjogJHNjb3BlLnVzZXJfcHJvZmlsZS5faWRcblx0XHRcdFx0fSlcblx0XHRcdFx0XHQuc3VjY2VzcyhmdW5jdGlvbiAodXNlcl9wb3N0cykge1xuXHRcdFx0XHRcdFx0JHNjb3BlLnVzZXJfcG9zdHMgPSB1c2VyX3Bvc3RzO1xuXHRcdFx0XHRcdFx0JHNjb3BlLnBhZ2luYXRlKCRzY29wZS51c2VyX3Bvc3RzLmxlbmd0aCk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdH0pXG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvIENoZWNrIGN1cnJlbnRseSBsb2dnZWQgaW4gdXNlciBcblx0XHQvLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdCRzY29wZS5jaGVja0xvZ2luID0gZnVuY3Rpb24oKSB7XG5cdFx0XHQvL2lzIGFueW9uZSBsb2dnZWQgaW5cblx0XHQgIFx0aWYgKHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW4pIHtcblx0XHRcdCAgXHQvL2dldCBjdXJyZW50IHVzZXJcblx0XHRcdCAgXHRVc2VyU3ZjLmdldFVzZXIoKVxuXHRcdFx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSl7XG5cdFx0XHRcdFx0XHQkc2NvcGUuY3VycmVudFVzZXIgPSByZXNwb25zZS5kYXRhO1xuXHRcdFx0XHRcdFx0XHQvL2lzIHRoZSB1c2VyIHRoZSBzYW1lIGFzIHRoZSB1c2VyIHdobydzIHBhZ2UgdGhpcyBpcyBvciB0aGV5IGhhdmUgYSBoaWdoZXIgcGVybWlzc2lvbiBsZXZlbCB0aGVuIGxldCB0aGVtIGVkaXQgdGhlIHBhZ2Vcblx0XHRcdFx0XHRcdFx0aWYgKCRzY29wZS51c2VyX3Byb2ZpbGUuX2lkID09ICRzY29wZS5jdXJyZW50VXNlci5faWQgfHwgJHNjb3BlLmVkaXRQZXJtaXNzaW9uKCRzY29wZS5jdXJyZW50VXNlci5wZXJtaXNzaW9uX2xldmVsKSApIHtcblx0XHRcdFx0XHRcdFx0XHQkc2NvcGUuY2FuRWRpdCA9IHRydWU7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvIEVuZCB1c2VyIGNoZWNrIFxuXHRcdC8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5cdFx0JHNjb3BlLmN1cnJlbnRVc2VyID0gW107XG5cblx0XHQkc2NvcGUuY2hlY2tMb2dpbigpO1xuXG5cdFx0JHNjb3BlLiRvbignJHZpZXdDb250ZW50TG9hZGVkJywgZnVuY3Rpb24oKXtcblx0XHRcdC8vdGhlIHBhZ2UgaXMgcmVhZHlcblx0XHR9KTtcblxuXHRcdC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdC8gUGFnaW5hdGlvbiBcblx0XHQvLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHRcdCRzY29wZS51c2VyX3Bvc3RzID0gW107XG5cblx0XHQkc2NvcGUuY3VycmVudFBhZ2UgPSAxO1xuXHRcdCRzY29wZS5wb3N0c1BlclBhZ2UgPSA1O1xuXG5cdFx0JHNjb3BlLnByZXZQYWdlID0gZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIGlmICgkc2NvcGUuY3VycmVudFBhZ2UgPiAxKSB7XG5cdCAgICAgICAgICAgICRzY29wZS5jdXJyZW50UGFnZS0tO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG4gICAgXG5cdCAgICAkc2NvcGUubmV4dFBhZ2UgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgaWYgKCRzY29wZS5jdXJyZW50UGFnZSA8ICRzY29wZS51c2VyX3Bvc3RzLmxlbmd0aC8kc2NvcGUucG9zdHNQZXJQYWdlKSB7XG5cdCAgICAgICAgICAgICRzY29wZS5jdXJyZW50UGFnZSsrO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG5cdCAgICBcblx0ICAgICRzY29wZS5zZXRQYWdlID0gZnVuY3Rpb24gKHBhZ2VfbnVtYmVyKSB7XG5cdCAgICAgICAgJHNjb3BlLmN1cnJlbnRQYWdlID0gcGFnZV9udW1iZXI7XG5cdCAgICB9O1xuXG5cdCAgICAvL1RoaXMgd2F5IEkgY2FuIGRvOiAgXCI8bGkgbmctcmVwZWF0PVwibiBpbiByYW5nZShwYWdlcykgdHJhY2sgYnkgJGluZGV4XCI+XCIgYW5kIHNvIEkgY2FuIGRpc3BsYXkgYXMgbWFueSBpdGVtcyBhcyB0aGUgdmFsdWUgb2YgYSBudW1iZXIgYXMgdGhpcyByZXR1cm5zIGFuIGFycmF5IG9mIHRoYXQgbGVuZ2h0XG5cdCAgICAkc2NvcGUucmFuZ2UgPSBmdW5jdGlvbihuKSB7XG4gICAgICAgIFx0cmV0dXJuIG5ldyBBcnJheShuKTtcbiAgICBcdH07XG5cdCAgICBcblxuXHRcdCRzY29wZS5wYWdpbmF0ZSA9IGZ1bmN0aW9uKG51bWJlcl9vZl9pdGVtcyl7XG5cdCAgICBcdGlmIChudW1iZXJfb2ZfaXRlbXMgPiAwKSB7XG5cdCAgICAgICAgXHQkc2NvcGUubnVtYmVyT2ZQYWdlcyA9IE1hdGguY2VpbChudW1iZXJfb2ZfaXRlbXMvJHNjb3BlLnBvc3RzUGVyUGFnZSk7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGVsc2Uge1xuXHQgICAgICAgIFx0JHNjb3BlLm51bWJlck9mUGFnZXMgPSBNYXRoLmNlaWwoJHNjb3BlLnVzZXJfcG9zdHMubGVuZ3RoLyRzY29wZS5wb3N0c1BlclBhZ2UpO1xuXHQgICAgICAgIH1cblx0ICAgIH07XG5cblxuXG5cdCAgICAvL1RoaXMgd2F5IEkgY2FuIGRvOiAgXCI8bGkgbmctcmVwZWF0PVwibiBpbiByYW5nZShwYWdlcykgdHJhY2sgYnkgJGluZGV4XCI+XCIgYW5kIHNvIEkgY2FuIGRpc3BsYXkgYXMgbWFueSBpdGVtcyBhcyB0aGUgdmFsdWUgb2YgYSBudW1iZXIgYXMgdGhpcyByZXR1cm5zIGFuIGFycmF5IG9mIHRoYXQgbGVuZ2h0XG5cdCAgICAkc2NvcGUucmFuZ2UgPSBmdW5jdGlvbihuKSB7XG4gICAgICAgIFx0cmV0dXJuIG5ldyBBcnJheShuKTtcbiAgICBcdH07XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvIEVuZCBQYWdpbmF0aW9uIFxuXHRcdC8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXHQgIFx0VXNlclN2Yy5hdXRob3JpemF0aW9uKCcxMCcpXG5cdFx0XHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2Upe1xuXHRcdFx0XHRjb25zb2xlLmxvZyhyZXNwb25zZSk7XG5cdFx0XHR9KVxuXG5cdFx0LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0LyBQcm9maWxlIGVkaXQgb3B0aW9ucyBcblx0XHQvLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cblx0XHQkc2NvcGUuc2F2ZVByb2ZpbGUgPSBmdW5jdGlvbiAoKSB7XG5cblx0XHRcdC8vZ2V0IHRoZSBpZCBvZiB0aGUgY3VycmVudGx5IGxvZ2dlZCBpbiB1c2VyJ3MgSUQuIFNvIHdlIGNhbiB1c2UgdGhpcyB0byBlZGl0IHRoZSB1c2VyLiB0b2RvOiBjaGFuZ2UgdGhpcyBzbyB0aGUgc3VwZXJ1c2VycyBjYW4gY2hvb3NlIHdobyBpcyBlZGl0ZWQgd2hlbiB0aGV5IHZpc2l0IHRoZSBwYWdlXG5cdFx0XHR2YXIgcHJvZmlsZV9kZXRhaWxzID0ge1xuXHRcdFx0XHRfaWQgOiAkc2NvcGUudXNlcl9wcm9maWxlLl9pZFxuXHRcdFx0fTtcblxuXHRcdFx0Ly9pdGVyYXRlIHRocm91Z2ggdGhlIG5ldyBkZXRhaWxzLCBpZiB0aGV5IGFyZSBub3QgZW1wdHkgdGhlbiBhZGQgdGhlbSB0byB0aGUgcHJvZmlsZSBkZXRhaWxzIG9iamVjdFxuXHRcdFx0Zm9yICh2YXIga2V5IGluICRzY29wZS5uZXcpIHtcblx0XHRcdCAgaWYgKCRzY29wZS5uZXcuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuXHRcdFx0ICAgIC8vYWxlcnQoa2V5ICsgXCIgLT4gXCIgKyAkc2NvcGUubmV3W2tleV0pO1xuXHRcdFx0ICAgIGlmICgkc2NvcGUubmV3W2tleV0gIT0gJycpIHtcblx0XHRcdCAgICBcdHByb2ZpbGVfZGV0YWlsc1trZXldID0gJHNjb3BlLm5ld1trZXldO1xuXHRcdFx0ICAgIH1cblx0XHRcdCAgfVxuXHRcdFx0fVxuXG5cdFx0XHQvL3NlbmQgdGhpcyBwcm9maWxlIGRldGFpbHMgb2JlamVjdCB0byB0aGUgdXNlciBzZXJ2aWNlLiBUaGlzIHRoZW4gdXBkYXRlZCBvciBhZGRzIGFsbCBkZXRhaWwgaW4gdGhpcyB0byB0aGUgdXNlciB3aG8ncyBJRCB3YXMgc2VsZWN0ZWQgZWFybGllclxuXHRcdFx0VXNlclN2Yy5wcm9maWxlVXBkYXRlKHByb2ZpbGVfZGV0YWlscylcblx0XHRcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24gKHVzZXIpIHtcblx0XHRcdFx0XHQvL2NvbnNvbGUubG9nKHVzZXIpO1xuXHRcdFx0XHRcdC8vVGhlIHVzZXJuYW1lIGlzIHVzZWQgYXMgcGFydCBvZiB0aGUgdXNlcnMgbG9naW4gdG9rZW4sIHNvIGlmIHRoZSB1c2VybmFtZSBjaGFuZ2VzIHRoZSB0b2tlbiBpcyBubyBsb25nZXIgdmFsaWQgKHRoaXMgaXMgbmVlZGVkIGZvciBzZWN1cml0eSByZWFzb25zKVxuXHRcdFx0XHRcdC8vdGhlcmVmb3JlIGNoYW5naW5nIGEgdXNlcm5hbWUgd2lsbCBlZmZlY3RpdmVseSBsb2cgc29tZW9uZSBvdXQuIFxuXHRcdFx0XHRcdC8vU28gd2UgbmVlZCB0byBjaGVjayBpZiB0aGVpciB1c2VybmFtZSB3YXMgY2hhbmdlZCwgYW5kIGlmIGl0IHdhcyB0aGVuIHNlbmQgdGhlbSB0byB0aGUgbG9naW4gcGFnZSBzbyB0aGV5IGNhbiBsb2cgaW50byB0aGV5IGFjY291bnQgYWdpYW4gYW5kIGdldCBhIG5ldyB0b2tlblxuXHRcdFx0XHRcdGlmICh1c2VyLnVzZXJuYW1lICE9ICRzY29wZS51c2VyX3Byb2ZpbGUudXNlcm5hbWUpIHtcblx0XHRcdFx0XHRcdCRzY29wZS5yZXR1cm5NZXNzYWdlID0gXCJZb3VyIHVzZXJuYW1lIHdhcyBjaGFuZ2VkIHNvIHlvdSBtdXN0IGxvZyBpbiBhZ2FpblwiO1xuXHRcdFx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbigpeyBcblx0XHRcdFx0XHRcdFx0d2luZG93LmxvY2F0aW9uLmhyZWY9ICcvIy9sb2dpbic7XG5cdFx0XHRcdFx0XHR9LCAxNTAwKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0ZWxzZSB7XG5cdFx0XHRcdFx0XHQkc2NvcGUucmV0dXJuTWVzc2FnZSA9IFwiRGV0YWlscyB1cGRhdGVkIHN1Y2Nlc3NmdWxseVwiO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcblx0XHRcdFx0fSlcblx0XHR9XG5cblx0XHQvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHQvIEVuZCBwcm9maWxlIGVkaXQgb3B0aW9ucyBcblx0XHQvLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29udHJvbGxlcignUmVnaXN0ZXJDdHJsJyAsIFtcIiRzY29wZVwiICwgXCJVc2VyU3ZjXCIgLCBmdW5jdGlvbiAoJHNjb3BlLCBVc2VyU3ZjKSB7XG5cdFx0JHNjb3BlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCwgcGFzc3dvcmRfY29uZmlybSkge1xuXHRcdFx0aWYgKHBhc3N3b3JkICE9IHBhc3N3b3JkX2NvbmZpcm0pIHtcblx0XHRcdFx0JHNjb3BlLnZhbGlkYXRpb25NZXNzYWdlID0gJ1lvdXIgcGFzc3dvcmRzIGRpZCBub3QgbWF0Y2guJztcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0VXNlclN2Yy5yZWdpc3Rlcih1c2VybmFtZSwgcGFzc3dvcmQpXG5cdFx0fVxuXHR9XSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcblx0LmNvbmZpZyhbXCIkcm91dGVQcm92aWRlclwiICxmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIpIHtcblx0XHQkcm91dGVQcm92aWRlclxuXHRcdFx0LndoZW4oJy8nICwge2NvbnRyb2xsZXI6ICdQb3N0c0N0cmwnLCB0ZW1wbGF0ZVVybDogJ3Bvc3RzLmh0bWwnfSlcblx0XHRcdC53aGVuKCcvcmVnaXN0ZXInICwge2NvbnRyb2xsZXI6ICdSZWdpc3RlckN0cmwnLCB0ZW1wbGF0ZVVybDogJ3JlZ2lzdGVyLmh0bWwnfSlcblx0XHRcdC53aGVuKCcvbG9naW4nICwge2NvbnRyb2xsZXI6ICdMb2dpbkN0cmwnLCB0ZW1wbGF0ZVVybDogJ2xvZ2luLmh0bWwnfSlcblx0XHRcdC53aGVuKCcvbG9nb3V0JyAsIHtjb250cm9sbGVyOiAnTG9naW5DdHJsJywgdGVtcGxhdGVVcmw6ICdsb2dvdXQuaHRtbCd9KVxuXHRcdFx0LndoZW4oJy9wb3N0LzpzbHVnJyAsIHtjb250cm9sbGVyOiAnU2luZ2xlUG9zdEN0cmwnLCB0ZW1wbGF0ZVVybDogJ3NpbmdsZVBvc3QuaHRtbCd9KVxuXHRcdFx0LndoZW4oJy9wb3N0L2lkLzppZCcgLCB7Y29udHJvbGxlcjogJ1NpbmdsZVBvc3RDdHJsJywgdGVtcGxhdGVVcmw6ICdzaW5nbGVQb3N0Lmh0bWwnfSlcblx0XHRcdC53aGVuKCcvdXNlci86dXNlcm5hbWUnICwge2NvbnRyb2xsZXI6ICdQcm9maWxlQ3RybCcsIHRlbXBsYXRlVXJsOiAndXNlci5odG1sJ30pXG5cdFx0XHQud2hlbignL3VzZXIvOnVzZXJuYW1lL2VkaXQnICwge2NvbnRyb2xsZXI6ICdQcm9maWxlQ3RybCcsIHRlbXBsYXRlVXJsOiAncHJvZmlsZS91c2VyUHJvZmlsZS5odG1sJ30pXG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuY29udHJvbGxlcignU2luZ2xlUG9zdEN0cmwnLCBbXCIkc2NvcGVcIiAsIFwiJGh0dHBcIiwgXCJQb3N0c1NlcnZpY2VcIiwgXCIkcm91dGVQYXJhbXNcIiwgXCIkcm91dGVcIiwgXCIkbG9jYXRpb25cIiAsIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCBQb3N0c1NlcnZpY2UsICRyb3V0ZVBhcmFtcywgJHJvdXRlLCAkbG9jYXRpb24pIHtcblxuXHRcdHZhciBwb3N0X3NsdWcgPSAkcm91dGVQYXJhbXMuc2x1Zztcblx0XHR2YXIgcG9zdF9pZCA9ICRyb3V0ZVBhcmFtcy5pZDtcblxuXHRcdCRzY29wZS4kb24oJyR2aWV3Q29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCl7XG5cdFx0XHQvL3RoZSBwYWdlIGlzIHJlYWR5XG5cdFx0fSk7XG5cblx0XHQkc2NvcGUuZGVsZXRlSXRlbSA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFBvc3RzU2VydmljZS5yZW1vdmVJdGVtKHtcblx0XHRcdFx0XHRwb3N0X2lkOiAkc2NvcGUucG9zdC5faWRcblx0XHRcdFx0fSlcblx0XHRcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2cocmVzcG9uc2UpO1xuXHRcdFx0XHRcdC8vIGNvbmZpcm0gc3VjY2Vzc2Z1bCBkZWxldGVcblx0XHRcdFx0fSlcblx0XHR9O1xuXG5cblx0XHRpZiAocG9zdF9zbHVnKSB7XG5cdFx0XHRQb3N0c1NlcnZpY2Uuc2luZ2xlX3NsdWcoe1xuXHRcdFx0XHRzbHVnOiBwb3N0X3NsdWdcblx0XHRcdH0pXG5cdFx0XHQuc3VjY2VzcyhmdW5jdGlvbiAocG9zdCkge1xuXHRcdFx0XHQkc2NvcGUucG9zdCA9IHBvc3RbMF07XG5cdFx0XHR9KVxuXHRcdH1cblx0XHRlbHNlIHtcblx0XHRcdFBvc3RzU2VydmljZS5zaW5nbGVfaWQoe1xuXHRcdFx0XHRpZDogcG9zdF9pZFxuXHRcdFx0fSlcdFx0XG5cdFx0XHQuc3VjY2VzcyhmdW5jdGlvbiAocG9zdCkge1xuXHRcdFx0XHQkc2NvcGUucG9zdCA9IHBvc3RbMF07XG5cdFx0XHR9KVxuXHRcdH1cdFx0XHRcdFxuXG5cdH1dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHQuc2VydmljZSgnVXNlclN2YycsIFtcIiRodHRwXCIsIGZ1bmN0aW9uKCRodHRwKSB7XG5cdFx0dmFyIHN2YyA9IHRoaXM7XG5cblx0XHRzdmMuZ2V0VXNlciA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdCRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW5cblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMnKVxuXHRcdFx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBcdFx0XHRyZXR1cm4gcmVzcG9uc2VcbiAgICBcdFx0fSlcblx0XHR9XG5cblx0XHRzdmMubG9naW4gPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkKSB7XG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9zZXNzaW9ucycsIHtcblx0XHRcdFx0dXNlcm5hbWU6IHVzZXJuYW1lLCBwYXNzd29yZDogcGFzc3dvcmRcblx0XHRcdH0pXG5cdFx0XHQudGhlbihmdW5jdGlvbiAodmFsKSB7XG5cdFx0XHRcdHdpbmRvdy5sb2NhbFN0b3JhZ2UudG9rZW4gPSB2YWwuZGF0YTtcblx0XHRcdFx0JGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gdmFsLmRhdGFcblx0XHRcdFx0cmV0dXJuIHN2Yy5nZXRVc2VyKCk7XG5cdFx0XHR9KVxuXHRcdH1cblxuXHRcdHN2Yy5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQsIHBhc3N3b3JkX2NvbmZpcm0pIHtcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzJywge1xuXHRcdFx0XHR1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZFxuXHRcdFx0fSlcblx0XHRcdC50aGVuKGZ1bmN0aW9uICh2YWwpIHtcblx0XHRcdFx0cmV0dXJuIHN2Yy5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXG5cdFx0XHRcdFx0LnRoZW4oZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5ocmVmPSAnLyc7XG5cdFx0XHRcdFx0fSlcblx0XHRcdH0pXG5cdFx0fVxuXG5cdFx0c3ZjLmF1dGhvcml6YXRpb24gPSBmdW5jdGlvbiAocGVybWlzc2lvbl9sZXZlbCkge1xuXHRcdFx0JGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gd2luZG93LmxvY2FsU3RvcmFnZS50b2tlbjtcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMvcGVybWlzc2lvbnMnKVxuXHRcdFx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcblx0XHRcdFx0aWYgKHJlc3BvbnNlLmRhdGEgPiBwZXJtaXNzaW9uX2xldmVsKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fSlcblx0XHR9XG5cblx0XHRzdmMubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0d2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd0b2tlbicpO1xuXHRcdFx0d2luZG93LmxvY2F0aW9uLmhyZWY9ICcvJztcblx0XHR9XG5cblx0XHRzdmMucHJvZmlsZSA9IGZ1bmN0aW9uICh1c2VybmFtZSkge1xuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycy9wcm9maWxlJywgeyBwYXJhbXM6IHt1c2VybmFtZTogdXNlcm5hbWV9IH0pXG5cdFx0fVxuXG5cdFx0c3ZjLnByb2ZpbGVVcGRhdGUgPSBmdW5jdGlvbiAocHJvZmlsZSkge1xuXHRcdFx0cmV0dXJuICRodHRwLnBvc3QoJy9hcGkvdXNlcnMvcHJvZmlsZScsIHByb2ZpbGUgKVxuXHRcdH1cblx0fV0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4ucnVuKFtcIiRyb290U2NvcGVcIiwgXCIkdGltZW91dFwiICwgXCIkd2luZG93XCIgLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHRpbWVvdXQsICR3aW5kb3cpIHtcblxuXHR2YXIgcmVjb25uZWN0X2RlbGF5ID0gMTA7XG5cdFxuXHQoZnVuY3Rpb24gY29ubmVjdCgpe1xuXHRcdC8vaW5jcmVtZW50IHRoZSByZWNvbm5lY3QgZGVsYXkgdGltZWVyXG5cdFx0cmVjb25uZWN0X2RlbGF5ICs9IHJlY29ubmVjdF9kZWxheTtcblxuXHRcdC8vQ3JlYXRlIGEgd2Vic29ja2V0IGNvbm5lY3Rpb24gd2l0aCB0aGUgc2VydmVyXG5cdFx0dmFyIGhvc3QgPSBcIndzOi8vXCIgKyAkd2luZG93LmxvY2F0aW9uLmhvc3Rcblx0XHQgIFxuXHRcdHZhciBjb25uZWN0aW9uID0gbmV3IFdlYlNvY2tldChob3N0KVxuXG5cdFx0Y29ubmVjdGlvbi5vbm9wZW4gPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHQvL2NvbnNvbGUubG9nKCdXZWJzb2NrZXQgY29ubmVjdGVkJylcblx0XHR9XG5cblxuXHRcdGNvbm5lY3Rpb24ub25jbG9zZSA9IGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRjb25zb2xlLmxvZygnV2Vic29ja2V0IGNvbm5lY3Rpb24gY2xvc2VkLiBBdHRlbXB0aW5nIHRvIHJlY2Nvbm5lY3QgaW4gJyArIHJlY29ubmVjdF9kZWxheSArICcgc2Vjb25kcycgKVxuXG5cdFx0XHQkdGltZW91dChjb25uZWN0LCByZWNvbm5lY3RfZGVsYXkqMTAwMCk7XG5cdFx0fSBcblxuXHRcdGNvbm5lY3Rpb24ub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHtcblx0XHRcdC8vY29uc29sZS5sb2coZSk7XG5cdFx0XHR2YXIgbWVzc2FnZSA9IEpTT04ucGFyc2UoZS5kYXRhKTtcblx0XHRcdFxuXHRcdFx0dmFyIG5hbWUgPSAnd3M6JyArIG1lc3NhZ2UudG9waWM7XG5cdFx0XHR2YXIgZGF0YSA9IG1lc3NhZ2UuZGF0YTtcblx0XHRcdC8vY29uc29sZS5sb2coXCJicm9hZGNhc3Rpbmc6IFwiKTtcblxuXHRcdFx0JHJvb3RTY29wZS4kYnJvYWRjYXN0KG5hbWUsIGRhdGEpO1xuXHRcdH1cblx0fSkoKVxufV0pIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9